S.SSCL.LoginHist=Backbone.Collection.extend({initialize:function(){_.bindAll(this)},getHistory:function(s){var e=s.success?s.success:null,t=s.error?s.error:null,i=S.sdkBase.request(S.sdkBase.servType.LOGIN,S.sdkBase.actions.GET_LOGIN_GAMEHISTORYSYNC,s.data);i.success?(this.reset(i.data),e.apply(this,[this,i])):(this.reset([]),t.apply(this,[this,i]))},getServerHistory:function(s){this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.QUERY_HISTORY,this.fetch(s)},parse:function(s){return s}});S.SSCL.QuestionList=Backbone.Collection.extend({initialize:function(){_.bindAll(this)},getQuestionList:function(i){this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.GET_QUESTION_HISTORY,this.fetch(i)},parse:function(i){return i}});S.SSCT.AccountManage=Backbone.Controller.extend({initialize:function(){_.bindAll(this)},getSecureState:function(e){this.secureModel=this.secureModel?this.secureModel:S.SSCT.GetHandler("Model","Secrecy"),this.secureModel.getSecureState({success:function(s,o){console.log("getSecureState success : "+JSON.stringify(o)),e.success(o.data)},error:function(s,o){console.log("getSecureState error : "+JSON.stringify(o)),e.error(o.msg)},quiet:!0})},getSecureStateDetail:function(e,s,o){this.secureModel=this.secureModel?this.secureModel:S.SSCT.GetHandler("Model","Secrecy"),this.secureModel.getSecureStateDetail({data:{items:e,name:_.isUndefined(o)?null:o},success:function(e,o){console.log("getSecureStateDetail success : "+JSON.stringify(o)),s.success(o.data)},error:function(e,o){console.log("getSecureStateDetail error : "+JSON.stringify(o)),s.error(o.msg)},quiet:!0})},sendCode2Mobile:function(e,s){this.secureModel=this.secureModel?this.secureModel:S.SSCT.GetHandler("Model","Secrecy"),this.secureModel.sendCodeToMobile({data:e,success:function(e,s){console.log("sendCodeToMobile success : "+JSON.stringify(s))},error:function(e,o){console.log("sendCodeToMobile error : "+JSON.stringify(o)),s.error(o.msg)},quiet:!0})},doBindMobile:function(e,s){this.secureModel=this.secureModel?this.secureModel:S.SSCT.GetHandler("Model","Secrecy");var o=S.global.versionCompare(S.global.version,rConfig.VERSIONS.SECURITY_VERSION);o!==!1&&o>=0&&(e.encrypt=rConfig.SECURITY_TYPE.SECURITY),this.secureModel.bindMobile({data:e,success:function(e,o){console.log("bindMobile success : "+JSON.stringify(o)),s.success()},error:function(e,o){console.log("bindMobile error : "+JSON.stringify(o)),s.error(o)},quiet:!0})},checkIsBinded:function(e,s){this.secureModel=this.secureModel?this.secureModel:S.SSCT.GetHandler("Model","Secrecy"),this.secureModel.checkIsBinded({data:e,success:function(e,o){console.log("checkIsBinded success : "+JSON.stringify(o)),s.success(o.data)},error:function(e,o){console.log("checkIsBinded error : "+JSON.stringify(o)),s.error(o.msg)},quiet:!0})},doSaveSecurityQuestions:function(e,s){var o=S.global.versionCompare(S.global.version,rConfig.VERSIONS.SECURITY_VERSION);o!==!1&&o>=0&&(e.encrypt=rConfig.SECURITY_TYPE.SECURITY),this.secureModel=this.secureModel?this.secureModel:S.SSCT.GetHandler("Model","Secrecy"),this.secureModel.saveSecurityQuestions({data:e,success:function(){s.success()},error:function(e,o){s.error(o)},quiet:!0})}});S.SSCT.Secrecy=Backbone.Controller.extend({initialize:function(){_.bindAll(this)},sendMsgToMobile:function(e,n){var r=S.SSCT.GetHandler("Model","Secrecy");r.changeUrl("sendMsgToMobile"),r.fetch({data:e,success:function(){var r=S.SSCT.GetHandler("Controller","General");r.setCacheData("phone",e.phone,1800,!0),n.success()},error:function(e,r){n.error(r.msg)},quiet:!0})},doBindMobile:function(e,n){var r=S.SSCT.GetHandler("Model","Secrecy");r.changeUrl("bindMobile"),r.fetch({data:e,success:function(){n.success()},error:function(e,r){n.error(r.msg)},quiet:!0})}});S.SSCT.Sso=Backbone.Controller.extend({initialize:function(){},CONFIG:{ACCOUNT_TYPE:{LOGIN:0,GAME_LOGIN:1},SECURITY_TYPE:{UNSECURITY:0,SECURITY:1}},histLength:{},serverHistLength:{},getHistLength:function(e){var s=this.histLength[e]?this.histLength[e]:0;return s},loginConfig:null,getLoginConfig:function(){return this.loginConfig||this.getLoginData(this.callBackMix(function(e){this.loginConfig=e})),this.loginConfig},histories:{},getHistories:function(e){return this.histories[e]?this.histories[e]:void 0},setHistories:function(e,s){this.histories[e]=s},serverHistories:{},getServerHistories:function(e){return this.serverHistories[e]?this.serverHistories[e]:void 0},validLoginData:function(e,s,r,t,i){i=i?i:{},i.error=i.error?i.error:function(){},i.success=i.success?i.success:function(){};var n={};if(0===s.length)return n.msg="密码不能为空",n.code=102,i.error(n),void 0;if(0===e.length)return n.msg="账号不能为空",n.code=101,i.error(n),void 0;if(r===this.CONFIG.ACCOUNT_TYPE.LOGIN){if(e.length<2||e.length>20)return n.msg="账号长度必须在2到20位之间",n.code=103,i.error(n),void 0;if(!rConfig.user.accountFilter.test(e)&&!rConfig.user.emailAccountFilter.test(e))return n.msg="账号格式错误",n.code=104,i.error(n),void 0;if((!t||!t.isSecurity)&&(s.length<6||s.length>20))return n.msg="密码长度必须在6到20位之间",n.code=105,i.error(n),void 0}i.success(e,s)},loginSubmit:function(e,s,r){r=r?r:{},r.error=r.error?r.error:function(){},r.success=r.success?r.success:function(){};var t=S.SSCT.GetHandler("Model","Sso");t.on("error",_.bind(function(e,s){r.error(e,{msg:s}),t.off("error")},this));var i=_.isUndefined(e.accountType)?0:e.accountType,n=_.isUndefined(e.rememberPassword)?!0:e.rememberPassword;e.accountType=i,e.rememberPassword=n;var o=t.set(e);o&&t.login({success:function(e,s){var t=S.SSCT.GetHandler("Controller","User");t.getCurUserInfo(),r.success(e,s)},error:function(e,s){r.error(e,s)},data:e,quiet:s})},getLoginData:function(e){var s=S.sdkBase.request(S.sdkBase.servType.LOGIN,S.sdkBase.actions.GET_LOGIN_CONFIG);!_.isUndefined(s)&&s.success?(this.loginConfig=s.data,e.success(s.data)):e.error(s?s.msg:"获取登录配置失败")},getHistory:function(e,s,r){r=_.isUndefined(r)?!1:r,s=s?s:{};var t=S.SSCT.GetHandler("Collection","LoginHist"),i=this;t.getHistory({success:function(r,t){var n=[];if(_.isUndefined(t.data)||_.isEmpty(t.data)||null==t.data||(n=t.data),i.histories[e]=n,i.histLength[e]=n.length?n.length:0,e===i.CONFIG.ACCOUNT_TYPE.LOGIN){var o=[],c=0;_.each(n,function(e){if(!i.checkIsFirmSuffix(e.account)){o[c]=e,c++;var s=S.SSCT.GetHandler("Controller","General").getCacheData("user_info_"+e.account,!0);s&&(e.isRandomPassword=s.random)}}),i.histories[e]=o,i.histLength[e]=o.length?o.length:0,s.success&&s.success(o)}else s.success&&s.success(n)},error:function(e,r){s.error&&s.error(r.msg)},data:{accountType:e},quiet:r})},getServerHistory:function(e,s){s=s?s:{};var r=S.SSCT.GetHandler("Collection","LoginHist"),t=this;return t.serverHistories[e]?(s.success&&s.success(t.serverHistories[e]),void 0):(r.getServerHistory({success:function(r,i){var n=[];if(_.isUndefined(i.data.uids)||_.isEmpty(i.data.uids)||null==i.data.uids||(n=i.data.uids),e===t.CONFIG.ACCOUNT_TYPE.LOGIN){var o=[],c=0;_.each(n,function(e){if(!t.checkIsFirmSuffix(e.account)){o[c]=e,c++;var s=S.SSCT.GetHandler("Controller","General").getCacheData("user_info_"+e.account,!0);s&&(e.isRandomPassword=s.random)}}),t.serverHistories[e]=o,t.serverHistLength[e]=o.length?o.length:0,s.success&&s.success(o)}else t.serverHistories[e]=n,t.serverHistLength[e]=n.length?n.length:0,s.success&&s.success(n)},error:function(e,r){s.error&&s.error(r.msg)},data:{accountType:e},quiet:!0}),void 0)},getHistByUsername:function(e,s,r){var t=null,i=this.histories[s];_.isUndefined(e)||_.isUndefined(i)||_.each(i,function(s){s.account==e&&(t=s)}),t?r.success&&r.success(t):r.error&&r.error("找不到匹配的用户账号")},clearHistFlag:function(e){e=e?e:{};var s=sdk.PageCache.get("clear_history");s.success&&1===s.data?(S.sdkBase.request(S.sdkBase.servType.APP,S.sdkBase.actions.CLEAR_HISTORY),sdk.PageCache.del("clear_history"),e.success&&e.success()):e.error&&e.error()},getLoginCount:function(e){var s=ucf.Cache.get("login_count_info",!0)||{};return s[e]||0},updateLoginCount:function(e){var s=ucf.Cache.get("login_count_info",!0)||{},r=s[e]||0;r++,s[e]=r,ucf.Cache.set("login_count_info",s,0,!0)},validSecrecy:function(e,s,r){var t=S.SSCT.GetHandler("Controller","AccountManage");t.getSecureStateDetail(["mobile","question"],t.callBackMix(function(e){var s=e.mobile||{},t=e.question||{};1===s.code&&_.isEmpty(s.mobile)&&(1===t.code||126===t.code)&&_.isEmpty(t.password_question)?r.success(e):r.error&&r.error("safe")},function(){r.error&&r.error("fail")}))},getGameNotice:function(e){e=e?e:{},e.error=e.error?e.error:function(){},e.success=e.success?e.success:function(){};var s=S.SSCT.GetHandler("Model","Sso");s.getGameNotice({success:function(s,r){var t,i,n=r.data.msgs;if(null==n)ucf.Cache.set("game_notice",{},0,!0);else if(t=n.length,0==t)ucf.Cache.set("game_notice",{},0,!0);else{i=n[0];for(var o=t-1;o>=0;o--)parseInt(n[o].priority)<parseInt(i.priority)&&(i=n[o]);ucf.Cache.set("game_notice",i,0,!0)}e.success(i)},error:function(s,r){ucf.Cache.set("game_notice",{},0,!0),e.error(r.msg)},data:{msgType:1},quiet:!0})},checkIsFirmSuffix:function(e){var s=new RegExp("#.*#$");return s.test(e)?!0:!1},removeFirmSuffix:function(e){if(!_.isUndefined(e)&&!_.isEmpty(e)){var s=new RegExp("([sS]*)#.*#$");return e.replace(s,"$1")}return e},getLoginCaptcha:function(e,s){var r=S.SSCT.GetHandler("Model","Sso");r.getLoginCaptcha({data:{userName:e,actionType:"login",sizeType:"default"},success:function(e,r){s.success&&s.success(r.data)},error:function(e,r){s.error&&s.error(r)},quiet:!1})}});S.SSCT.SsoLn=Backbone.Controller.extend({initialize:function(){},CONFIG:{ACCOUNT_TYPE:{LOGIN:0},SECURITY_TYPE:{UNSECURITY:0,SECURITY:1}},histLength:{},serverHistLength:{},loginConfig:null,histories:{},serverHistories:{},getHistLength:function(e){var s=this.histLength[e]?this.histLength[e]:0;return s},getLoginConfig:function(){return this.loginConfig||this.getLoginData(this.callBackMix(function(e){this.loginConfig=e})),this.loginConfig},getHistories:function(e){return this.histories[e]?this.histories[e]:void 0},setHistories:function(e,s){this.histories[e]=s},getServerHistories:function(e){return this.serverHistories[e]?this.serverHistories[e]:void 0},validLoginData:function(e,s,r,i,t){t=t?t:{},t.error=t.error?t.error:function(){},t.success=t.success?t.success:function(){};var n={};return _.isUndefined(s)||0===s.length?(n.msg="密码不能为空",n.code=102,t.error(n),void 0):_.isUndefined(e)||0===e.length?(n.msg="账号不能为空",n.code=101,t.error(n),void 0):S.global.channelSetting.valid.loginAccount.test(e)?i&&i.isSecurity||S.global.channelSetting.valid.loginPassworid.test(s)?(t.success(e,s),void 0):(n.msg="密码格式错误",n.code=105,t.error(n),void 0):(n.msg="账号格式错误",n.code=104,t.error(n),void 0)},loginSubmit:function(e,s,r){r=r?r:{},r.error=r.error?r.error:function(){},r.success=r.success?r.success:function(){};var i=S.SSCT.GetHandler("Model","SsoLn");i.on("error",_.bind(function(e,s){r.error(e,{msg:s}),i.off("error")},this));var t=_.isUndefined(e.accountType)?0:e.accountType,n=_.isUndefined(e.rememberPassword)?!0:e.rememberPassword;e.accountType=t,e.rememberPassword=n,e.account=this.addFirmSuffix(e.account),i.set(e)&&i.login({success:function(e,s){var i=S.SSCT.GetHandler("Controller","UserLn");i.getCurUserInfo(),r.success(e,s)},error:function(e,s){r.error(e,s)},data:e,quiet:s})},validRegisterData:function(e,s,r){var i={};return _.isEmpty(e)?(i.msg="账号不能为空",r.error(i),void 0):_.isEmpty(s)?(i.msg="密码不能为空",r.error(i),void 0):S.global.channelSetting.valid.registerAccount.test(e)?S.global.channelSetting.valid.registerPassword.test(s)?(r.success(e,s),void 0):(i.msg="密码必须包含至少8个字符，且包含字母、数字或符号中的两种",r.error(i),void 0):(i.msg="账号格式错误",r.error(i),void 0)},getLoginData:function(e){var s=S.sdkBase.request(S.sdkBase.servType.LOGIN,S.sdkBase.actions.GET_LOGIN_CONFIG);!_.isUndefined(s)&&s.success?(this.loginConfig=s.data,e.success(s.data)):e.error(s?s.msg:"获取登录配置失败")},getHistory:function(e,s,r){r=_.isUndefined(r)?!1:r,s=s?s:{};var i=S.SSCT.GetHandler("Collection","LoginHist"),t=this;i.getHistory({success:function(r,i){var n=[];if(!_.isUndefined(i.data)&&i.data.length>=0){var o=0;_.each(i.data,function(e){t.checkIsFirmSuffix(e.account)&&(n[o]=e,o++)})}t.histories[e]=n,t.histLength[e]=n.length?n.length:0,s.success&&s.success(n)},error:function(e,r){s.error&&s.error(r.msg)},data:{accountType:e},quiet:r})},getServerHistory:function(e,s){s=s?s:{};var r=S.SSCT.GetHandler("Collection","LoginHist"),i=this;return i.serverHistories[e]?(s.success&&s.success(i.serverHistories[e]),void 0):(r.getServerHistory({success:function(r,t){var n=[];if(!_.isUndefined(t.data.uids)&&t.data.uids.length>=0){var o=0;_.each(t.data.uids,function(e){i.checkIsFirmSuffix(e.account)&&(n[o]=e,o++)})}i.serverHistories[e]=n,i.serverHistLength[e]=n.length?n.length:0,s.success&&s.success(n)},error:function(e,r){s.error&&s.error(r.msg)},data:{accountType:e},quiet:!0}),void 0)},getHistByUsername:function(e,s,r){var i=null,t=this.histories[s];_.isUndefined(e)||_.isUndefined(t)||_.each(t,function(s){s.account==e&&(i=s)}),i?r.success&&r.success(i):r.error&&r.error("找不到匹配的用户账号")},clearHistFlag:function(e){e=e?e:{};var s=sdk.PageCache.get("clear_history");s.success&&1===s.data?(S.sdkBase.request(S.sdkBase.servType.APP,S.sdkBase.actions.CLEAR_HISTORY),sdk.PageCache.del("clear_history"),e.success&&e.success()):e.error&&e.error()},getGameNotice:function(e){e=e?e:{},e.error=e.error?e.error:function(){},e.success=e.success?e.success:function(){};var s=S.SSCT.GetHandler("Model","SsoLn");s.getGameNotice({success:function(s,r){var i,t,n=r.data.msgs;if(null==n)ucf.Cache.set("game_notice",{},0,!0);else if(i=n.length,0==i)ucf.Cache.set("game_notice",{},0,!0);else{t=n[0];for(var o=i-1;o>=0;o--)parseInt(n[o].priority)<parseInt(t.priority)&&(t=n[o]);ucf.Cache.set("game_notice",t,0,!0)}e.success(t)},error:function(s,r){ucf.Cache.set("game_notice",{},0,!0),e.error(r.msg)},data:{msgType:1},quiet:!0})},addFirmSuffix:function(e){return e+"#"+S.global.channelSetting.mark+"#"},removeFirmSuffix:function(e){if(!_.isUndefined(e)&&!_.isEmpty(e)){var s=new RegExp("([sS]*)#"+S.global.channelSetting.mark+"#$");return e.replace(s,"$1")}return e},checkIsFirmSuffix:function(e){var s=new RegExp("([sS]*)#"+S.global.channelSetting.mark+"#$");return s.test(e)?!0:!1}});S.SSCT.User=Backbone.Controller.extend({initialize:function(){_.bindAll(this)},curUser:{},userName:"",getCurUser:function(){return this.curUser},setCurUser:function(e){this.curUser=e},getCurUserInfo:function(e){var r=S.sdkBase.request(S.sdkBase.servType.COMMON,S.sdkBase.actions.GET_CURR_USER);r.success?(this.curUser=r.data,e&&e.success&&e.success.apply(this,[r.data])):e&&e.error&&e.error.apply(this,[r.msg])},getBaseUserInfo:function(e,r){e=e?e:{};var s=ucf.Cache.get("userBaseInfo_"+this.curUser.ucid,!0);if(_.isUndefined(s)||_.isEmpty(s)){var t=S.SSCT.GetHandler("Model","User");r=_.isUndefined(r)?!1:r,t.fetchBaseUserInfo({data:{uid:this.curUser.ucid},success:$.proxy(function(r){s=r.toJSON(),ucf.Cache.set("userBaseInfo_"+this.curUser.ucid,s,1800,!0),e.success&&e.success.apply(this,[s])},this),error:$.proxy(function(r,s){e.error&&e.error.apply(this,[s.msg])},this),quiet:r})}else e.success&&e.success.apply(this,[s])},updatePass:function(e,r){var s=r.success?r.success:function(){},t=r.error?r.error:function(){},o=S.SSCT.GetHandler("Model","User");o.off("error"),o.on("error",$.proxy(function(e,r){t.apply(this,[r])},this));var c=o.set(e);c&&o.updatePass({success:$.proxy(function(){this.getCurUserInfo(this.callBackMix(function(e){ucf.Cache.set("user_info_"+e.ucid,{random:!1},0,!0)})),s()},this),error:$.proxy(function(e,r){t.apply(this,[r.msg])},this),data:e})},registerUpdatePass:function(e,r){var s=r.success?r.success:function(){},t=r.error?r.error:function(){},o=S.SSCT.GetHandler("Model","User");o.off("error"),o.on("error",$.proxy(function(e,r){t.apply(this,[r])},this));var c=o.set(e),n=this;c&&o.updatePass({success:$.proxy(function(){n.getCurUserInfo(n.callBackMix(function(r){n.setRegData(r.ucid,e.password),ucf.Cache.set("user_info_"+r.ucid,{random:!1},0,!0)})),s()},this),error:$.proxy(function(e,r){t.apply(this,[r.msg])},this),data:e})},register:function(e,r,s){r=r?r:{},s=_.isUndefined(s)?!1:s;var t=S.SSCT.GetHandler("Model","Register");t.off("error"),t.on("error",function(e,s){r.error(s)});var o=t.set(e);o&&t.register({data:e,success:$.proxy(function(e,s){this.setRegData(e.get("ucid"),e.get("password"));var t=S.SSCT.GetHandler("Controller","General");t.setCacheData("regUcid",e.get("ucid"),1800,!0),r.success(e,s)},this),error:function(e,s){r.error(s.msg)},quiet:s})},sdkExit:function(){S.sdkBase.request(S.sdkBase.servType.LOGIN,S.sdkBase.actions.LOGIN_EXIT_SDK)},getVipInfo:function(e){var r=S.SSCT.GetHandler("Model","Vip");r.fetchVipInfo({success:function(r,s){_.isUndefined(s)||_.isUndefined(s.data)?e.error&&e.error(s):e.success&&e.success(s.data)},error:function(r,s){e.error&&e.error(s)},data:{}})},notifyCp:function(e,r,s){switch(s=_.isUndefined(s)||_.isEmpty(s)?"login":s){case"login":var t=S.sdkBase.request(S.sdkBase.servType.LOGIN,S.sdkBase.actions.LOGIN_NOTIFY_CP,{code:e.code,msg:e.msg});break;case"logout":var t=S.sdkBase.request(S.sdkBase.servType.LOGIN,S.sdkBase.actions.LOGOUT_NOTIFY_CP,e)}t.success?r&&r.success&&r.success.apply(this):r&&r.error&&r.error.apply(this)},setRegData:function(e,r){sdk.PageCache.set("regInfo",JSON.stringify({ucid:e,password:r}))},getRegData:function(e){var r=sdk.PageCache.get("regInfo");e&&(r.success?e.success&&!_.isEmpty(r.data)?e.success(JSON.parse(r.data)):e.error():e.error&&e.error())},getFeatureSwitch:function(e){var r=e&&e.success?e.success:function(){},s=e&&e.error?e.error:function(){},t=S.sdkBase.request(S.sdkBase.servType.COMMON,S.sdkBase.actions.GET_FEATURE_SWITCH);t.success?r.apply(this,[t.data]):s.apply(this,[t])},logout:function(e){var r=e&&e.success?e.success:function(){},s=e&&e.error?e.error:function(){},t=S.sdkBase.request(S.sdkBase.servType.LOGIN,S.sdkBase.actions.LOGOUT);t.success?(this.notifyCp(null,null,"logout"),r.apply()):s.apply()},setNerverNotice:function(e,r,s){var t=ucf.Cache.get("nerver_notice_info",!0)||{};s=_.isUndefined(s)?"existAccount":s,t[e]=t[e]||{},t[e][s]=r,ucf.Cache.set("nerver_notice_info",t,0,!0)},checkNoticeInfo:function(e,r){var s=ucf.Cache.get("nerver_notice_info",!0)||{};return r=_.isUndefined(r)?"existAccount":r,s[e]=s[e]||{},s[e][r]?!0:!1},getSecQuestion:function(e,r){var s=S.SSCT.GetHandler("Model","User");return e&&0!==e?rConfig.user.accountFilter.test(e)?(s.getSecQuestion({data:{ucid:parseInt(e)},success:function(e,s){s.data?r.success&&r.success(s.data):r.error&&r.error(s.msg)},error:function(e,s){r.error&&r.error(s)}}),void 0):(r.error&&r.error("UC账号必须为数字"),void 0):(r.error&&r.error("请输入UC账号"),void 0)},validateAnswer:function(e,r){var s=S.SSCT.GetHandler("Model","User");return e.password_answer&&0!==e.password_answer.length?(s.validateAnswer({data:e,success:function(e,s){r.success&&r.success(s)},error:function(e,s){r.error&&r.error(s.msg)}}),void 0):(r.error&&r.error("请输入密保问题答案"),void 0)},resetPassword:function(e,r){var s=S.SSCT.GetHandler("Model","User");if(e.password.length<6||e.password.length>20)return r.error&&r.error("密码长度不符（6-20位）"),void 0;if(e.password.match(rConfig.user.passwordFilter))return r.error&&r.error("密码必须为字母或数字"),void 0;var t=S.global.versionCompare(S.global.version,rConfig.VERSIONS.SECURITY_VERSION);t!==!1&&t>=0&&(e.encrypt=rConfig.SECURITY_TYPE.SECURITY),s.resetPassword({data:e,success:function(s,t){var o=ucf.Cache.get("user_info_"+e.ucid,!0);o&&o.random&&ucf.Cache.set("user_info_"+e.ucid,{random:!1},0,!0),r.success&&r.success(t.data)},error:function(e,s){r.error&&r.error(s.msg)}})},updateNickname:function(e,r){var s=r.success?r.success:function(){},t=r.error?r.error:function(){},o=S.SSCT.GetHandler("Model","User"),c=this;o.off("error"),o.on("error",$.proxy(function(e,r){t.apply(this,[r])},this));var n=o.set(e);n&&o.updateNickname({success:$.proxy(function(){c.getCurUserInfo();var r=c.curUser,t=ucf.Cache.get("userBaseInfo_"+r.ucid,!0);t&&ucf.Cache.remove("userBaseInfo_"+r.ucid,!0),this.userName=e.userName,s()},this),error:$.proxy(function(e,r){t.apply(this,[r.msg])},this),data:e})},removeHistory:function(e,r){var s=S.SSCT.GetHandler("Model","User");s.removeHistory({data:e,success:function(){r.success()},error:function(e,s){r.error&&r.error(s.msg)},quiet:!0})},getLoginHistoryCount:function(e,r){var s=S.SSCT.GetHandler("Model","User");s.getLoginHistoryCount({data:e,success:function(e,s){r.success&&r.success(s.data)},error:function(e,s){r.error&&r.error(s.msg)},quiet:!0})},registerGuestAccount:function(e,r){var s=S.SSCT.GetHandler("Model","User");s.registerGuestAccount({data:e,success:function(e,s){r.success&&r.success(s)},error:function(e,s){r.error&&r.error(s)},quiet:!1})},bindGuestAccount:function(e,r){var s=S.SSCT.GetHandler("Model","User");s.bindGuestAccount({data:e,success:function(e,s){r.success&&r.success(s)},error:function(e,s){r.error&&r.error(s)},quiet:!1})},rechargeUPoint:function(e,r){var s=S.SSCT.GetHandler("Model","User");s.rechargeUPoint({data:e,success:function(e,s){r.success&&r.success(s.data)},error:function(e,s){r.error&&r.error(s)}})},setAutoLoginState:function(e,r){var s=S.SSCT.GetHandler("Model","User");s.setAutoLoginState({data:e,success:function(e,s){r.success&&r.success(s.data)},error:function(e,s){r.error&&r.error(s)},quiet:!0})},getAccountMobileBindInfo:function(e,r){var s=S.SSCT.GetHandler("Model","User");s.getAccountMobileBindInfo({data:{loginName:e},success:function(e,s){r.success&&r.success(s.data)},error:function(e,s){r.error&&r.error(s)},quiet:!1})},getAccountInfoByLoginName:function(e,r){var s=S.SSCT.GetHandler("Model","User");s.getAccountInfoByLoginName({data:{loginName:e},success:function(e,s){r.success&&r.success(s.data)},error:function(e,s){r.error&&r.error(s)},quiet:!0})},validMsgRetakeAccount:function(e,r){var s="";_.isEmpty(e)?(s="账号不为空",r.error(s)):e.length<2||e.length>20?(s="账号长度必须在2到20位之间",r.error(s)):rConfig.user.accountFilter.test(e)||rConfig.user.emailAccountFilter.test(e)?r.success():(s="账号格式错误",r.error(s))}});S.SSCT.UserLn=Backbone.Controller.extend({initialize:function(){_.bindAll(this)},curUser:{},getCurUser:function(){return this.curUser},setCurUser:function(s){this.curUser=s},getCurUserInfo:function(s){var e=S.sdkBase.request(S.sdkBase.servType.COMMON,S.sdkBase.actions.GET_CURR_USER);e.success?(this.curUser=e.data,s&&s.success&&s.success.apply(this,[e.data])):s&&s.error&&s.error.apply(this,[e.msg])},getBaseUserInfo:function(s,e){s=s?s:{};var r=ucf.Cache.get("userBaseInfo_"+this.curUser.ucid,!0);if(_.isUndefined(r)||_.isEmpty(r)){var t=S.SSCT.GetHandler("Model","UserLn");e=_.isUndefined(e)?!1:e,t.fetchBaseUserInfo({data:{uid:this.curUser.ucid},success:$.proxy(function(e){r=e.toJSON(),ucf.Cache.set("userBaseInfo_"+this.curUser.ucid,r,1800,!0),s.success&&s.success.apply(this,[r])},this),error:$.proxy(function(e,r){s.error&&s.error.apply(this,[r.msg])},this),quiet:e})}else s.success&&s.success.apply(this,[r])},register:function(s,e,r){e=e?e:{},r=_.isUndefined(r)?!1:r;var t=S.SSCT.GetHandler("Model","RegisterLn");t.off("error"),t.on("error",function(s,r){e.error(r)}),t.register({data:s,success:$.proxy(function(s,r){this.setRegData(s.get("ucid"),s.get("password"));var t=S.SSCT.GetHandler("Controller","General");t.setCacheData("regUcid",s.get("ucid"),1800,!0),e.success(s,r)},this),error:function(s,r){e.error(r.msg)},quiet:r})},setRegData:function(s,e){sdk.PageCache.set("regInfo",JSON.stringify({ucid:s,password:e}))},sdkExit:function(){S.sdkBase.request(S.sdkBase.servType.LOGIN,S.sdkBase.actions.LOGIN_EXIT_SDK)},notifyCp:function(s,e,r){switch(r=_.isUndefined(r)||_.isEmpty(r)?"login":r){case"login":var t=S.sdkBase.request(S.sdkBase.servType.LOGIN,S.sdkBase.actions.LOGIN_NOTIFY_CP,{code:s.code,msg:s.msg});break;case"logout":var t=S.sdkBase.request(S.sdkBase.servType.LOGIN,S.sdkBase.actions.LOGOUT_NOTIFY_CP,s)}t.success?e&&e.success&&e.success.apply(this):e&&e.error&&e.error.apply(this)},getFeatureSwitch:function(s){var e=s&&s.success?s.success:function(){},r=s&&s.error?s.error:function(){},t=S.sdkBase.request(S.sdkBase.servType.COMMON,S.sdkBase.actions.GET_FEATURE_SWITCH);t.success?e.apply(this,[t.data]):r.apply(this,[t])},logout:function(s){var e=s&&s.success?s.success:function(){},r=s&&s.error?s.error:function(){},t=S.sdkBase.request(S.sdkBase.servType.LOGIN,S.sdkBase.actions.LOGOUT);t.success?(this.notifyCp(null,null,"logout"),e.apply()):r.apply()},removeHistory:function(s,e){console.log("wensj: removeHistory controller :"+s.account);var r=S.SSCT.GetHandler("Model","UserLn");r.removeHistory({data:s,success:function(){e.success()},error:function(s,r){e.error&&e.error(r.msg)},quiet:!0})},setAutoLoginState:function(s,e){var r=S.SSCT.GetHandler("Model","UserLn");r.setAutoLoginState({data:s,success:function(s,r){e.success&&e.success(r.data)},error:function(s,r){e.error&&e.error(r)},quiet:!0})}});S.SSCT.Pay=Backbone.Controller.extend({getUPointBalance:function(e){var n=e&&e.success?e.success:function(){},o=e&&e.error?e.error:function(){},r=S.SSCT.GetHandler("Model","UPoint");r.fetchUPoint({success:n,error:o,data:null,quiet:!0})}});S.SSMO.Register=Backbone.Model.extend({initialize:function(){_.bindAll(this),this.url=S.sdkBase.servType.LOGIN+"/"+S.sdkBase.actions.REGISTER,this.isRequest=!1},validate:function(s){if(!this.isRequest){if(_.isEmpty(s.password))return"密码不能为空，请重新输入";if(s.password.length<6||s.password.length>20)return"密码长度为6-20位";if(s.password.match(rConfig.user.passwordFilter))return"密码只能为英文字母和数字，请重新输入";if(!s.agree)return"不同意UC账号服务协议无法注册哦^-^"}this.isRequest=!1},register:function(s){this.fetch(s)},parse:function(s){return this.isRequest=!0,s.data}});S.SSMO.RegisterLn=Backbone.Model.extend({initialize:function(){_.bindAll(this),this.url=S.sdkBase.servType.LOGIN+"/"+S.sdkBase.actions.REGISTER},validate:function(){},parse:function(e){return e.data},register:function(e){e.data.name=e.data.name+"#"+S.global.channelSetting.mark+"#",this.fetch(e)}});S.SSMO.Secrecy=Backbone.Model.extend({initialize:function(){_.bindAll(this)},validate:function(s){console.log(s),null===s.mobile&&console.log("手机号码不为null")},validateMobile:function(s){return null===s.match(rConfig.user.mobileFilter)?{msg:"手机号码必须为数字",success:!1}:11!==s.length||"1"!==s[0]?{msg:"手机号码输入错误",success:!1}:{msg:"success",success:!0}},validateCode:function(s){return null==s||""==s?{msg:"验证码不能为空",success:!1}:{msg:"success",success:!0}},validateQuestions:function(s){return s.length<2||s.length>20?{msg:"密保问题长度必须在2~20位之间",success:!1}:{msg:"success",success:!0}},validateQuestionAnswers:function(s){return s.length<2||s.length>20?{msg:"密保答案长度必须在2~20位之间",success:!1}:{msg:"success",success:!0}},validatePassword:function(s){return s.length<6||s.length>20?{msg:"密码长度必须在6~20位之间",success:!1}:{msg:"success",success:!0}},parse:function(s){return s.data},getSecureState:function(s){this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.UCID_ACCOUNT_QUERYSECURESTATE,this.fetch(s)},getSecureStateDetail:function(s){this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.UCID_ACCOUNT_GETSECURESTATE,this.fetch(s)},sendCodeToMobile:function(s){this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.UCID_ACCOUNT_SENDMOBILESMSCODE,this.fetch(s)},bindMobile:function(s){var e=this.validateCode(s.data.code),t=this.validatePassword(s.data.password);e.success?t.success?(this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.UCID_ACCOUNT_BINDMOBILEBYSMSCODE,this.fetch(s)):s.error(this,t):s.error(this,e)},checkIsBinded:function(s){var e=this.validateMobile(s.data.mobile);e.success?(this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.UCID_ACCOUNT_CHECKISBINDED,this.fetch(s)):s.error(this,e)},saveSecurityQuestions:function(s){var e=this.validateQuestions(s.data.password_question),t=this.validateQuestionAnswers(s.data.password_answer),i=this.validatePassword(s.data.password);e.success?t.success?i.success?(this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.UCID_ACCOUNT_SETPASSWORDQUESTION,this.fetch(s)):s.error(this,i):s.error(this,t):s.error(this,e)}});S.SSMO.Sso=Backbone.Model.extend({defaults:{rememberPassword:!0},initialize:function(){_.bindAll(this)},login:function(s){this.url=S.sdkBase.servType.LOGIN+"/"+S.sdkBase.actions.LOGIN,this.fetch(s)},getGameNotice:function(s){this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.GET_GAMENOTICE,this.fetch(s)},getLoginCaptcha:function(s){this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.AUTH_CAPTCHA_GETCAPTCHA,this.fetch(s)},parse:function(s){this.isRequest=!0;var e=s.data||s;return e}});S.SSMO.SsoLn=Backbone.Model.extend({defaults:{rememberPassword:!0},initialize:function(){_.bindAll(this)},parse:function(e){this.isRequest=!0;var s=e.data||e;return s},login:function(e){this.url=S.sdkBase.servType.LOGIN+"/"+S.sdkBase.actions.LOGIN,this.fetch(e)},getGameNotice:function(e){this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.GET_GAMENOTICE,this.fetch(e)}});S.SSMO.User=Backbone.Model.extend({initialize:function(){_.bindAll(this)},fetchBaseUserInfo:function(s){this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.USER_BASEINFO,console.log("do fetch"),this.fetch(s)},updatePass:function(s){this.url=S.sdkBase.servType.LOGIN+"/"+S.sdkBase.actions.CHANGE_PASSWORD,this.fetch(s)},validate:function(s){if(_.isUndefined(s.isPostDetail)){if(!_.isUndefined(s.isPostPass)){if(s.password.length<6||s.password.length>20)return"密码长度不符（6-20位）";if(s.password.match(rConfig.user.passwordFilter))return"密码必须为字母或数字";if(s.oldPassword.length<6||s.oldPassword.length>20)return"密码长度不符（6-20位）"}}else;},parse:function(s){return s.data},getSecQuestion:function(s){this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.SECURITY_QUESTION,this.fetch(s)},validateAnswer:function(s){this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.VALIDATE_ANSWER,this.fetch(s)},resetPassword:function(s){this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.RESET_PASSWORD,this.fetch(s)},removeHistory:function(s){var e=S.sdkBase.request(S.sdkBase.servType.LOGIN,S.sdkBase.actions.DELETE_LOGIN_HISTORY,s.data);e.success?s.success.apply(this,[this,e]):(this.reset([]),s.error.apply(this,[this,e]))},updateNickname:function(s){this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.UPDATE_NICKNAME,this.fetch(s)},getLoginHistoryCount:function(s){this.url=S.sdkBase.servType.LOGIN+"/"+S.sdkBase.actions.GET_LOGIN_HISTORY_COUNT,this.fetch(s)},registerGuestAccount:function(s){this.url=S.sdkBase.servType.LOGIN+"/"+S.sdkBase.actions.REGISTER_GUEST,this.fetch(s)},bindGuestAccount:function(s){this.url=S.sdkBase.servType.LOGIN+"/"+S.sdkBase.actions.ACTIVATE_GUEST,this.fetch(s)},rechargeUPoint:function(s){this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.PAYCENTER_UPOINT_AUTOLOGIN,this.fetch(s)},setAutoLoginState:function(s){this.url=S.sdkBase.servType.LOGIN+"/"+S.sdkBase.actions.SET_AUTO_LOGIN_STATE,this.fetch(s)},getAccountMobileBindInfo:function(s){this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.GET_ACCOUNT_INFO,this.fetch(s)}});S.SSMO.UserLn=Backbone.Model.extend({initialize:function(){_.bindAll(this)},validate:function(){},parse:function(s){return s.data},fetchBaseUserInfo:function(s){this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.USER_BASEINFO,this.fetch(s)},removeHistory:function(s){var e=S.sdkBase.request(S.sdkBase.servType.LOGIN,S.sdkBase.actions.DELETE_LOGIN_HISTORY,s.data);e.success?s.success.apply(this,[this,e]):(this.reset([]),s.error.apply(this,[this,e]))},setAutoLoginState:function(s){this.url=S.sdkBase.servType.LOGIN+"/"+S.sdkBase.actions.SET_AUTO_LOGIN_STATE,this.fetch(s)}});S.SSMO.Vip=Backbone.Model.extend({initialize:function(){_.bindAll(this),this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.VIP_INFO},fetchVipInfo:function(i){this.fetch(i)},parse:function(i){return i.data}});S.SSMO.UPoint=Backbone.Model.extend({initialize:function(){_.bindAll(this),this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.UPOINT_BALANCE},fetchUPoint:function(i){this.fetch(i)},parse:function(i){var n=i.data;return n}});S.SSVW.FindPassword=Backbone.View.extend({el:"#userContainer",events:{"click #sendCmccMessageBtn":"sendCmccMessage","click #sendUnicomMessageBtn":"sendUnicomMessage","onclick #secAnswerSubBtn":"secAnswerSubmit","onclick #newPasswordSubBtn":"newPasswordSubmit","onclick #needResetPassword":"checkedNeedResetPassword","onclick #appealRetakeBtn":"retakeMethod","onclick #forgetpasswordRetakeBtn":"retakeMethod","onclick #toAppealRetakeBtn":"toAppealRetake","onclick #toAppealRetakeByIdBtn":"toAppealRetakeByTabId","onclick #resetPassReturnGameBtn":"returnGame","onclick #accountList > .ac-item":"retakeAccount","onclick #commitAccountBtn":"commitAccount"},local:{defaultTab:"forgetpasswordRetake",tabs:["forgetpasswordRetake","appealRetake"]},initialize:function(){_.bindAll(this),this.controller=S.SSCT.GetHandler("Controller","User"),this.ssoController=S.SSCT.GetHandler("Controller","Sso"),this.generalController=S.SSCT.GetHandler("Controller","General"),this._platformVerFix(!1),sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_enterfp_p"],!0);var e=this;setTimeout(function(){e.passwordRetake()},200)},sendCmccMessage:function(){this._platformVerFix(!0);var e=this.$el.find("#sendCmccMessageBtn").attr("data");window.location.href=e,sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_fpwphone_b"],!0)},sendUnicomMessage:function(){this._platformVerFix(!0);var e=this.$el.find("#sendUnicomMessageBtn").attr("data");window.location.href=e,sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_fpwphone_b"],!0)},showMsgRetakeCon:function(e){this.$el.find("#bindedNumber").html(e),this.$el.find("#beforeMsgRetakeCon").addClass("ms-none"),this.$el.find("#msgRetakeCon").removeClass("ms-none"),this.$el.find("#fgpwRetakeWaysList").addClass("ms-none");var s=this;this.generalController.getClientConfig(this.generalController.callBackMix(function(e){if(!_.isUndefined(e)&&!_.isUndefined(e.pwdSms)){var n=e.pwdSms;_.isUndefined(n.p_notice)||s.$el.find("#findPwd_p_notice").html("<span style='color:red'>公告：</span>"+n.p_notice).removeClass("ms-none"),_.isUndefined(n.p1_flag)||(1==n.p1_flag?(s.$el.find("#findPwd_p1_text").html(n.p1_text),s.$el.find("#findPwd_p1_msg_content").html("请编写短信内容: "+n.p1_content+"发送到"+n.p1_number),s.$el.find("#sendCmccMessageBtn").attr("data","sms:"+n.p1_number+"?body="+n.p1_content)):(s.$el.find("#findPwd_p1_text").hide(),s.$el.find("#findPwd_p1_msg_content").hide(),s.$el.find("#sendCmccMessageBtn").hide())),_.isUndefined(n.p2_flag)||(1==n.p2_flag?(s.$el.find("#findPwd_p2_text").html(n.p2_text),s.$el.find("#findPwd_p2_msg_content").html("请编写短信内容: "+n.p2_content+"发送到"+n.p2_number),s.$el.find("#sendUnicomMessageBtn").attr("data","sms:"+n.p2_number+"?body="+n.p2_content)):(s.$el.find("#findPwd_p2_text").hide(),s.$el.find("#findPwd_p2_msg_content").hide(),s.$el.find("#sendUnicomMessageBtn").hide()))}},function(){}))},securityAnswer:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_fpwquestion_p"],!0);var e=sdk.PageCache.get("account_security_question");if(e.success&&e.data){var s=this.$el.find("#question"),n=this.$el.find("#ucAccount");s.html(e.data.question),s.attr("data-value",e.data.question),n.html(e.data.account),n.attr("data-value",e.data.account)}},secAnswerSubmit:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_fpwquestion_b"],!0);var e=this.$el.find("#securityAnswer").val(),s=this.$el.find("#question").attr("data-value"),n=this.$el.find("#ucAccount").attr("data-value"),t=this;this.controller.validateAnswer({ucid:parseInt(n,10),password_question:s,password_answer:e},this.controller.callBackMix(function(){sdk.PageCache.set("account_resetPassword_params",{account:n,question:s,answer:e}),sdk.Url.location.route("#!findPassword/resetPassword/"+n)},function(e){console.log(e),t._showErrorMsg(e)}))},resetPassword:function(e){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_fpwmodifypw_p"],!0),this.$el.find("#resetPassAccount").attr("data-value",e),S.sdkBase.request(S.sdkBase.servType.APP,S.sdkBase.actions.OVERRIDE_BACK_BTN,{override:!0}),document.addEventListener("backbutton",function(){S.sdkBase.request(S.sdkBase.servType.APP,S.sdkBase.actions.OVERRIDE_BACK_BTN,{override:!1})})},newPasswordSubmit:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_fpwmodifypwsubmit_b"],!0);var e=this.$el.find("#newPassword").val(),s=this.$el.find("#resetPassAccount").attr("data-value"),n=sdk.PageCache.get("account_resetPassword_params"),t=this;if(n.success&&n.data){var o=n.data;this.controller.resetPassword({ucid:parseInt(s,10),password_question:o.question,password_answer:o.answer,password:e},this.controller.callBackMix(function(){$("body").addClass("btnClick-none"),t.$el.find("#successBox").removeClass("ms-none")},function(e){t._showErrorMsg(e)}))}},passwordRetake:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["forgetPassword"],!0),this.$el.find("#chooseTab").on("click",function(e){var s=e.target;$(s).css("boxShadow","none")});var e;if(S.SCEV.Proxy.trigger(S.SCEV.EventType.SDK_REMOVE_WIN_EVENT,{eventName:"bridgeTopBtnClicked"}),S.SCEV.Proxy.trigger(S.SCEV.EventType.SDK_WINDOW_EVENT,{eventName:"bridgeTopBtnClicked",handler:function(s){"backToLogin"==s.action&&(S.sdkBase.request(S.sdkBase.servType.APP,S.sdkBase.actions.OVERRIDE_BACK_BTN,{override:!1}),e=!0,S.Url.location.route("#!sso/login"),S.sdkBase.request(S.sdkBase.servType.APP,S.sdkBase.actions.CLEAR_HISTORY))}}),e!==!0){var s=rConfig.ACCOUNT_TYPE.UC,n=this.tabType||this.local.defaultTab;this.showRetakePageByTab(n);var t=this,o=S.global.channelSetting.name+"账号";this.ssoController.getServerHistory(s,this.ssoController.callBackMix(function(e){var s="",n=t.$el.find("#accountList"),i=t.$el.find("#hasAccount");e.length>0?(n.removeClass("ms-none"),i.html("曾在本机登录过的"+o+"："),_.each(e,function(e){var n="";e.loginTime&&(n=e.loginTime),s+='<div class="ac-item" data-account='+e.ucid+" data-password="+e.password+">"+'<em class="em_arrow">&nbsp;</em>'+o+"："+e.ucid+"<br />最近登录时间："+n+"</div>"}),n.html(s)):i.html("！没有在本机登录过"+o)},function(e){t._showErrorMsg(e)})),sdkInfo=S.sdkBase.sdkInfo(),this.$el.find("#clientVersion").html("客户端版本号："+sdkInfo.ve)}},commitAccount1:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_fpcommitaccount_b"],!0);var e=this.$el.find("#forgetpasswrodAccountInp").val(),s=this;S.SSCT.GetHandler("Controller","AccountManage"),s.controller.validMsgRetakeAccount(e,{success:function(){function n(){2==o&&(i.length>0&&a.length>0&&(s.$el.find("#fpTips").removeClass("ms-none"),i==a&&s._showErrorMsg(i)),sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_fpways "+t+"_b"],!0))}var t="",o=0,i="",a="";s.controller.getAccountMobileBindInfo(e,{success:function(e){var i=e.mobile;if(!_.isEmpty(i)){t+="_phone";var a=s.$el.find("#fgpwPhoneRetakeBtn");a.removeAttr("style"),a.find(".icon_uc").removeClass("fpmob_dis_icon").addClass("fpmob_icon"),a.bind("click",function(){s.fgpwPhoneRetake(i)})}o++,n()},error:function(e){_.isUndefined(e)||_.isUndefined(e.msg)||(i=e.msg),o++,n()}}),s.controller.getSecQuestion(e,s.controller.callBackMix(function(i){if(i.password_question){sdk.PageCache.set("account_security_question",{account:e,question:i.password_question}),t+="_ques";var a=s.$el.find("#fgpwQuestionRetakeBtn");a.removeAttr("style"),a.find(".icon_uc").removeClass("fpque_dis_icon").addClass("fpque_icon"),a.bind("click",function(){s.fgpwQuestionRetake(i.password_question,e)})}o++,n()},function(e){_.isUndefined(e)||_.isUndefined(e.msg)||(a=e.msg),o++,n()})),s._showPasswordRetakeMain()},error:function(e){s._showErrorMsg(e)}})},commitAccount:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_fpcommitaccount_b"],!0);var e=this.$el.find("#forgetpasswrodAccountInp").val(),s=this,n=S.SSCT.GetHandler("Controller","AccountManage");s.controller.validMsgRetakeAccount(e,{success:function(){var t=0,o="";n.getSecureStateDetail(["mobile","question","email"],n.callBackMix(function(n){if(!_.isUndefined(n)){if(!_.isUndefined(n.mobile)&&!_.isUndefined(n.mobile.code)&&1==n.mobile.code&&!_.isUndefined(n.mobile.mobile)&&11==n.mobile.mobile.length){t++,o+="_phone";var i=s.$el.find("#fgpwPhoneRetakeBtn");i.removeAttr("style"),i.find(".icon_uc").removeClass("fpmob_dis_icon").addClass("fpmob_icon"),i.bind("click",function(){s.fgpwPhoneRetake(n.mobile.mobile)})}if(!_.isUndefined(n.question)&&!_.isUndefined(n.question.code)&&1==n.question.code&&!_.isUndefined(n.question.password_question)){t++,o+="_ques",sdk.PageCache.set("account_security_question",{account:e,question:n.question.password_question});var a=s.$el.find("#fgpwQuestionRetakeBtn");a.removeAttr("style"),a.find(".icon_uc").removeClass("fpque_dis_icon").addClass("fpque_icon"),a.bind("click",function(){s.fgpwQuestionRetake(n.question.password_question,e)})}0==t&&(s.$el.find("#fpTips").removeClass("ms-none"),s._showErrorMsg("您的账号没有进行任何绑定"))}sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_fpways "+o+"_b"],!0),s._showPasswordRetakeMain()},function(e){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_fpways "+o+"_b"],!0),s._showErrorMsg(_.isUndefined(e)?"查询密保状态失败":e)}),e)},error:function(e){s._showErrorMsg(e)}})},fgpwPhoneRetake:function(e){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_fpbyphone_b"],!0),this.showMsgRetakeCon(e)},fgpwQuestionRetake:function(e,s){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_fpbyquestion_b"],!0),this.$el.find("#fgpwRetakeWaysList").addClass("ms-none"),$questionRetakeCon=this.$el.find("#questionRetakeCon"),$questionRetakeCon.removeClass("ms-none"),$questionRetakeCon.find("#accountName").text(S.global.channelSetting.name);var n=$questionRetakeCon.find("#question"),t=$questionRetakeCon.find("#ucAccount");n.html(e),n.attr("data-value",e),t.html(s),t.attr("data-value",s)},fgpwMailRetake:function(e,s){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_fpbymail_b"],!0);var n=this;this.$el.find("#fgpwRetakeWaysList").addClass("ms-none");var t=this.$el.find("#emailRetakeCon");t.find("#emailAddress").text(e),t.find("#emailAddress").attr("data-value",s),t.removeClass("ms-none"),t.find("#backToLoginBtn").bind("click",function(){n.backToLoginAfterSendEmail()})},backToLoginAfterSendEmail:function(){var e=this.$el.find("#emailRetakeCon").find("#emailAddress").attr("data-value");this._jumtoLogin(e)},_showPasswordRetakeMain:function(){var e=this.$el.find("#fgpwRetakeEnterAccount"),s=this.$el.find("#fgpwRetakeWaysList");e.addClass("ms-none"),s.removeClass("ms-none"),this.$el.find("#fpAccountName").text(S.global.channelSetting.name),sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_fpways_p"],!0)},getInfoByAccount:function(e){if(!e)return null;var s=null;return _.each(this.ssoController.getServerHistories(rConfig.ACCOUNT_TYPE.UC),function(n){n.account==e&&(s=n)}),s},retakeMethod:function(e){this._platformVerFix(!1);var s=e.target,n=$(s).attr("data-retake");n&&this.showRetakePageByTab(n)},showRetakePageByTab:function(e){this.tabType=e;var s=this.local.tabs,n=this;_.each(s,function(s){s!==e&&(n.$el.find("#"+s).addClass("ms-none"),n.$el.find("."+s).parent().removeClass("on"))}),this.$el.find("#"+e).removeClass("ms-none"),this.$el.find("."+e).parent().addClass("on")},checkedNeedResetPassword:function(){var e=this.$el.find("#needResetPassword");"checked"===e.attr("data-checked")?(e.attr("data-checked",""),e.removeClass("cbbg")):(e.attr("data-checked","checked"),e.addClass("cbbg"))},toAppealRetake:function(){this.tabType="appealRetake",sdk.Url.location.route("#!findPassword/passwordRetake/appealRetake")},toAppealRetakeByTabId:function(){this.showRetakePageByTab("appealRetake")},retakeAccount:function(e){if($(e.target).hasClass("ac-item")){var s=$(e.target).attr("data-account");$(e.target).attr("data-password"),this._jumtoLogin(s)}},_jumtoLogin:function(e){!S.global.ui||S.global.ui===rConfig.SDK_UI.STANDARD||S.global.versionCompare(S.global.version,rConfig.VERSIONS.LOGIN_WIDGET_VERSION)<0?(console.log("Redirect to H5 login"),sdk.Url.location.route("#!sso/login/"+e)):S.global.ui===rConfig.SDK_UI.LOGIN_WIDGET&&(console.log("Jumto to login widget"),this.generalController.jumpToLoginWidget({uiBusiness:"loginWidget",data:{ucid:e}},{success:function(){},error:function(){sdk.Url.location.route("#!sso/login/"+e)}}))},returnGame:function(){var e=this.$el.find("#newPassword").val(),s=this.$el.find("#resetPassAccount").attr("data-value");sdk.PageCache.set("auto_login_info",{account:s,password:e,securityType:0}),S.sdkBase.request(S.sdkBase.servType.APP,S.sdkBase.actions.OVERRIDE_BACK_BTN,{override:!1}),this._jumtoLogin(s),this.generalController.clearHistory()},_showErrorMsg:function(e){this.generalController.sendClientMsg(e)},flushInpt:function(e){_.isEmpty($(e.target).val())&&$(e.target).val(""),_.isUndefined(this.noticeBar)||_.isEmpty(this.noticeBar)||sdk.common.ui.NoticeBox.hide(this.noticeBar,null,"slide")},_platformVerFix:function(e){-1!=navigator.userAgent.indexOf("Nexus 4")&&(e===!0?S.sdkBase.request(S.sdkBase.servType.APP,S.sdkBase.actions.OVERRIDE_BACK_BTN,{override:!0}):S.sdkBase.request(S.sdkBase.servType.APP,S.sdkBase.actions.OVERRIDE_BACK_BTN,{override:!1}))}});S.SSVW.Register=Backbone.View.extend({el:"#userContainer",events:{"onclick #newPassword":"flushInpt","onclick #regReturnGameBtn":"returnGame","onclick #modifyPassMask":"closeModifyPassword","onclick #cancelModifyBtn":"closeModifyPassword","onclick #doModifyBtn":"doModifyPassword","onclick #regBindBtn":"gotoBind"},isOpenModifyWindow:!1,initialize:function(){_.bindAll(this),this.$body=$("body"),this.controller=S.SSCT.GetHandler("Controller","User"),this.generalController=S.SSCT.GetHandler("Controller","General"),this.ssoController=S.SSCT.GetHandler("Controller","Sso")},regSuccess:function(){S.SCEV.Proxy.trigger(S.SCEV.EventType.PRE_ROUTE,{enterPage:sdk.Log.businesses.PAGE_USER,enterBusiness:["registerSuccess"]});var e=this;this.controller.getRegData(this.controller.callBackMix(function(s){e.ssoController.updateLoginCount(s.ucid);var o=e.generalController.getCacheData("user_info_"+s.ucid);o&&!1===o.random&&e.$el.find("#passwordName").html("密码:"),e.$el.find("#regTitle").html("成功注册UC账号"),e.$el.find("#regMsg1").html("UC账号："+s.ucid),e.$el.find("#regUcAccount").attr("data-account",s.ucid).html(s.ucid),e.$el.find("#regPassword").attr("data-password",s.password).html(s.password)},function(){sdk.Url.back()}))},modifyPassword:function(){function e(){var e=parseInt($(window).height()),s=parseInt($(document).height());return e>s?e:s}sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_signmodifypw_b"]);var s=this;this.$el.find("#newPassword").val(""),this.$el.find("#modifyPassMask").height(e()),$(window).on("resize",function(){s.$el.find("#modifyPassMask").height(e())}),this.hideFeedBack(),this.$body.addClass("btnClick-none"),this.$el.find("#modifyPassWin").removeClass("ms-none"),this.isOpenModifyWindow=!0,S.sdkBase.request(S.sdkBase.servType.APP,S.sdkBase.actions.OVERRIDE_BACK_BTN,{override:!0}),document.addEventListener("backbutton",s.closeModifyPassword)},closeModifyPassword:function(){this.isOpenModifyWindow&&(this.$el.find("#modifyPassWin").addClass("ms-none"),this.$el.find(".btnClick-none").removeClass("btnClick-none"),this.$body.removeClass("btnClick-none"),S.sdkBase.request(S.sdkBase.servType.APP,S.sdkBase.actions.OVERRIDE_BACK_BTN,{override:!1}),document.removeEventListener("backbutton",this.closeModifyPassword),$(window).off("resize"))},doModifyPassword:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_signmodifypwok_b"]);var e=this.$el.find("#newPassword").val(),s={isPostPass:!0,oldPassword:this.$el.find("#regPassword").html(),password:e},o=this;this.controller.registerUpdatePass(s,this.controller.callBackMix(function(){o.generalController.sendClientMsg("修改成功"),o.$el.find("#passwordName").html("密码:"),o.$el.find("#regPassword").html(e),o.closeModifyPassword()},function(e){o.generalController.sendClientMsg(e)}))},returnGame:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_signgame_b"]);var e=this;this.controller.getRegData(this.controller.callBackMix(function(s){var o=ucf.Cache.get("openTestGame_"+s.ucid,!0),n=ucf.Cache.get("isAlpha_"+s.ucid,!0);return o&&o.status&&"B"==o.status?(sdk.Url.redirect("../game/game.html#!game/notOpen/"+encodeURIComponent(o.message)),void 0):n?(sdk.Url.redirect("../game/game.html#!game/validCode/false"),void 0):(e.controller.sdkExit(),void 0)},function(){sdk.Url.back()}))},gotoBind:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_signbindphone_b"]),S.Url.location.route("#!secrecy/preBind/signpage")},flushInpt:function(e){_.isEmpty($(e.target).val())&&$(e.target).val("")},_showLoading:function(){var e=S.common.ui.NoticeBox.loading();return e},_hideLoading:function(e){S.common.ui.NoticeBox.hide(e,null,"remove")},hideFeedBack:function(){this.$el.find("input").addClass("btnClick-none")}});S.SSVW.Secrecy=Backbone.View.extend({el:"#userContainer",controller:null,config:{btnLockTime:59,questionList:["我曾就读的小学校名？","刻骨铭心的6位数字？","我的心愿是？","我的爱好是？","最难忘那年那月那日？","最喜欢的一句话是？","我最关注的是什么？","最想要的物品名称？"],sourcePage:{USER:"usercenter",BIND:"ucidbindpage",REGISTER:"signpage",LOGIN:"loginpage"}},events:{"onclick #mobile, #validCode, #bindPass":"_flushInpt","onclick #toBindPageBtn":"toBindPage","onclick #doBindBtn":"doBind","onclick #resendBtn":"reSendMsg","onclick #cancelIbbBtn":"cancelIbb","onclick #keepBindBtn":"keepBind","onclick #toGameBtn":"doBindSuccess","onclick #toSetQuestionsBtn":"toSetQuestions","change  #questionList":"selQuestion","onclick #saveSecurityBtn":"saveSecurityQuestions","input #bindPass":"hideRandomPassNotice","onclick #bindPhoneTabBtn, #setQuestionTabBtn":"setBindTabHandle","onclick #pGotoSecCenterBtn,#qGotoSecCenterBtn":"redirectBtnHandle","onclick #changeNumberBtn":"changeNumberHandle"},initialize:function(){_.bindAll(this),this.$body=$("body"),this.controller=this.controller?this.controller:S.SSCT.GetHandler("Controller","AccountManage"),this.generalController=S.SSCT.GetHandler("Controller","General")},toBindPage:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_pwsphonecode_b",this.enterType]),this.hideFeedBack("#toBindPageBtn");var e=this.$el.find("#mobile").val(),n={mobile:e},i=this._showLoading(),t=this;this.controller.checkIsBinded(n,this.controller.callBackMix(function(e){t._hideLoading(i);var n=S.SSCT.GetHandler("Controller","General");n.setCacheData("mobile",$("#mobile").val(),10800,!0),null!==e.ucid?(t.beforeBoxShowed(),S.sdkBase.request(S.sdkBase.servType.APP,S.sdkBase.actions.OVERRIDE_BACK_BTN,{override:!0}),document.addEventListener("backbutton",function(){t.cancelIbb()}),t._showBindBox()):t.setRouteType("#!secrecy/bind")},function(e){t._hideLoading(i),t._showErrorMsg(e),console.log("checkIsBinded error : "+e)}))},_showBindBox:function(){this._hideLinkEffect(["cancelIbbBtn","keepBindBtn"],$("#bindPhoneCnt")[0]),sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_pwsphonebind_w"]),this.$body.addClass("btnClick-none");var e=this.$el.find("#isBindBox");e.css("display","block")},doBind:function(){this.hideFeedBack("#doBindBtn");var e={code:this.$el.find("#validCode").val(),password:this.$el.find("#bindPass").val()},n=this._showLoading(),i=this;this.controller.doBindMobile(e,this.controller.callBackMix(function(){i._hideLoading(n),i.beforeBoxShowed();var e=S.SSCT.GetHandler("Controller","General"),t=i.getUserInfo().ucid,s=e.getCacheData("mobile",!0);i._showBindSuccessBox({ucid:t,mobile:s})},function(e){i._hideLoading(n),101==e.code&&i.$el.find("#bindPass").val(""),i._showErrorMsg(e.msg)}))},_showBindSuccessBox:function(e){this._hideLinkEffect("toGameBtn",this.$el.find("#bindPhoneCnt")[0]),sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_pwsphoneok_w",this.enterType]),this.$el.find("#bindSuccessNoti").html("<p>UC账号：<em>"+e.ucid+"</em><br>绑定手机号：<em>"+e.mobile+"</em></p>"),this.$el.find("#bindSuccTitle").html("您已绑定成功！"),this.$el.find("#toGameBtn").data("step","changePhone"),this.$body.addClass("btnClick-none"),this.$el.find("#bindPopBox").removeClass("ms-none"),this.enterType===this.config.sourcePage.USER?this.$el.find("#toGameBtn").html("完成"):this.$el.find("#toGameBtn").html("进入游戏")},reSendMsg:function(){this.$el.find("#resendBtn").hasClass("clickAble")&&this.sendMsg()},cancelIbb:function(){S.sdkBase.request(S.sdkBase.servType.APP,S.sdkBase.actions.OVERRIDE_BACK_BTN,{override:!1}),sdk.EC.showInput(),this.hideFeedBack("#cancelIbbBtn");var e=this;setTimeout(function(){e.addFeedBack("#cancelIbbBtn")},500),this.addFeedBack("#toBindPageBtn");var n=this.$el.find("#isBindBox")[0];n.style.display="none",this.$body.removeClass("btnClick-none")},keepBind:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_pwsphonebind_b"]),this.cancelIbb(),S.SSCT.GetHandler("Controller","General"),this.setRouteType("#!secrecy/bind")},doBindSuccess:function(e){var n=$(e.target),i=n.data("step"),t=this;this.hideFeedBack("#toGameBtn"),setTimeout(function(){t.addFeedBack("#toGameBtn")},500),this.addFeedBack("#doBindBtn"),this.$el.find("#bindPopBox").addClass("ms-none"),this.$body.removeClass("btnClick-none"),"changePhone"===i?sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_pwsphoneok_game_b",this.enterType]):sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_pwsquestion_game_b",this.enterType]),this.enterType===this.config.sourcePage.USER?(S.Url.location.route("#!user"),this.generalController.clearHistory()):this.toGame()},toSetQuestions:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_pwsquestion_l"]),this.setRouteType("#!secrecy/securityQuestions")},selQuestion:function(){var e=document.querySelector("#questionList"),n=e.options[e.selectedIndex],i=n.value;"-1"!=i&&""!=i&&("0"==i?this.$el.find("#passwordQuestion").val(""):this.$el.find("#passwordQuestion").val(i))},saveSecurityQuestions:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_submitQuestion_b",,this.enterType]),this.hideFeedBack("#saveSecurityBtn");var e={password_question:this.$el.find("#passwordQuestion").val(),password_answer:this.$el.find("#passwordAnswer").val(),password:this.$el.find("#questionPass").val()},n=this._showLoading(),i=this;this.controller.doSaveSecurityQuestions(e,this.controller.callBackMix(function(){i._hideLoading(n),i.beforeBoxShowed();var e=i.getUserInfo().ucid;i._showQuestionBindSuccessBox({ucid:e})},function(e){i._hideLoading(n),101==e.code&&i.$el.find("#questionPass").val(""),i._showErrorMsg(e.msg)}))},_showQuestionBindSuccessBox:function(e){this._hideLinkEffect("toGameBtn",$("#setQuestionCnt")[0]),sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_pwsquestion_w",this.enterType]),this.$el.find("#bindSuccessNoti").html("<p>UC账号<em>"+e.ucid+"</span>已成功设置密保问题。</em></p>"),this.$el.find("#bindSuccTitle").html("您已设置成功！"),this.$el.find("#toGameBtn").data("step","changeQuestion"),this.$body.addClass("btnClick-none"),this.$el.find("#bindPopBox").removeClass("ms-none"),this.enterType===this.config.sourcePage.USER?this.$el.find("#toGameBtn").html("完成"):this.$el.find("#toGameBtn").html("进入游戏")},_initPopbox:function(){this.$el.find("#bindPopBox").length<=0&&this.$el.append($("#bindPopBoxTempl").html())},initBackBtnEvent:function(){var e=this;S.SCEV.Proxy.trigger(S.SCEV.EventType.SDK_REMOVE_WIN_EVENT,{eventName:"bridgeTopBtnClicked"}),S.SCEV.Proxy.trigger(S.SCEV.EventType.SDK_WINDOW_EVENT,{eventName:"bridgeTopBtnClicked",handler:function(n){"sdBackGame"==n.action&&e.toGame(),"backToUsercenter"==n.action&&(e._isStop=!0,e._retryLoadingElem&&(e._hideLoading(e._retryLoadingElem),e._retryLoadingElem=null),S.Url.back())}})},toGame:function(){var e=this.getUserInfo().ucid,n=ucf.Cache.get("openTestGame_"+e,!0),i=ucf.Cache.get("isAlpha_"+e,!0);n&&n.status&&"B"==n.status?sdk.Url.redirect("../game/game.html#!game/notOpen/"+encodeURIComponent(n.message)):i?sdk.Url.redirect("../game/game.html#!game/validCode/false"):(S.Log.pageClose(),S.SSCT.GetHandler("Controller","User").sdkExit())},_renderPhoneBindSuccess:function(e,n){this.$el.find("#pBindChangeInfo").html("<b>UC账号："+e+"</b><br /><b>已绑定手机号码："+n+"</b>"),this.$el.find("#pBingChangeNoti").html('<h6 class="f-gray">您已绑定手机，可通过手机号找回账号、密码，还可直接使用手机号登录游戏。</h6><p class="p_fs f14">如需修改手机号，请前往账户中心设置。</p>'),this.$el.find("#pGotoSecCenterBtn").data("type","updateMobile")},_renderGotoPhoneBinding:function(){this.$el.find("#pBindChangeInfo").addClass("ms-none"),this.$el.find("#pBingChangeNoti").html('<h6 class="f-gray">如需继续提高账号安全，可前往账户中心，把您的UC账号和手机进行绑定。</h6>'),this.$el.find("#pGotoSecCenterBtn").html("绑定手机号码").data("type","setMobile")},_renderQuestionBindSuccess:function(e){this.$el.find("#qBingChangeNoti").html('<h6 class="f-gray">您已为UC账号 <em>'+e+"</em>  设置密保问题，忘记密码时可通过此方式找回密码。</h6>"+'<p class="p_fs f14">如需修改密保问题，请前往账户中心设置。</p>'),this.$el.find("#qGotoSecCenterBtn").data("type","updateQuestion")},_renderGotoQuestionBinding:function(){this.$el.find("#qBingChangeNoti").html('<h6 class="f-gray">如需继续提高账号安全，可前往账户中心，为您的UC账号设置密保问题。</h6>'),this.$el.find("#qGotoSecCenterBtn").html("设置密保问题").data("type","setQuestion")},_renderBindingFail:function(){this.$el.html(this.$el.find("#screcyPageTempl").html()),this.$el.find("#secrecy_con").html('<section class="ui-maincontainer"><center class="gr-mt20"><h6 class="f-gray">暂时无法获取您的账号安全情况<h6></center></section>')},setPageState:function(e,n){var i,t;if(ucid=this.getUserInfo().ucid,"mobile"===e||"question"===e||"both"===e){switch(this.$el.html(template.render("screcyPageTempl")),i=this.$el.find("#bindPhoneCnt"),t=this.$el.find("#setQuestionCnt"),e){case"mobile":i.html(template.render("phoneBindingChangeTempl")),t.html(template.render("questionBindingChangeTempl")),this._renderPhoneBindSuccess(ucid,n),this._renderGotoQuestionBinding();break;case"question":i.html(template.render("phoneBindingChangeTempl")),t.html(template.render("questionBindingChangeTempl")),this._renderGotoPhoneBinding(),this._renderQuestionBindSuccess(ucid);break;case"both":i.html(template.render("phoneBindingChangeTempl")),t.html(template.render("questionBindingChangeTempl")),this._renderPhoneBindSuccess(ucid,n),this._renderQuestionBindSuccess(ucid);break;case"none":}("mobile"==e||"question"==e||"both"==e)&&S.global.otherChannel&&this.$el.find("#phoneBindChangeAcLb").html(S.global.channelSetting.name+"账号:"+i.html())}},setBindTabHandle:function(e){var n=$(e.target),i=n.data("type");i&&this.setBindTab(i)},redirectBtnHandle:function(e){var n,i=$(e.target).data("type");if(i){switch(i){case"setQuestion":n=eConfig.setQuestion;break;case"setMobile":n=eConfig.setMobile;break;case"updateQuestion":n=eConfig.updateQuestion;break;case"updateMobile":n=eConfig.updateMobile}n&&(this.businessLoging(i),sdk.Url.redirect(n))}},businessLoging:function(e){var n;if(e){switch(e){case"setMobile":n=["h5_pwsphone_open_b"];break;case"updateMobile":n=["h5_resetPhoneNum_b"];break;case"setQuestion":n=["h5_pwsquestion_open_b"];break;case"updateQuestion":n=["h5_resetQuestion_b"]}n&&sdk.Log.click(sdk.Log.businesses.PAGE_USER,n)}},setBindTab:function(e){function n(){t.parent().addClass("on"),o.removeClass("ms-none").addClass("pagefocus"),s.parent().removeClass("on"),a.addClass("ms-none").removeClass("pagefocus")}function i(){t.parent().removeClass("on"),o.addClass("ms-none").removeClass("pagefocus"),s.parent().addClass("on"),a.removeClass("ms-none").addClass("pagefocus")}var t=this.$el.find("#bindPhoneTabBtn"),s=this.$el.find("#setQuestionTabBtn"),o=this.$el.find("#bindPhoneCnt"),a=this.$el.find("#setQuestionCnt");switch(this._bindTabType=e,e){case"question":i(),this._pageType="question";break;case"mobile":n(),this._pageType="mobile"}var d=$(".pagefocus .tabPage",this.el);if($(".pagefocus .tabPage",this.el).length>0){var l;switch(d.data("page")){case"bind":l=["bind"];break;case"preBind":l=["preBind",this.enterType];break;case"question":l=["preBind_question",this.enterType]}l&&(S.Log.pageClose(),S.SCEV.Proxy.trigger(S.SCEV.EventType.PRE_ROUTE,{enterPage:sdk.Log.businesses.PAGE_USER,enterBusiness:l}))}},_getSecStateRetry:function(e){function n(){return t._isStop?(t._isStop=!1,t._hideLoading(s),void 0):(i.getSecureStateDetail(["mobile","question"],i.callBackMix(function(n){if(1===n.mobile.code&&(1===n.question.code||126===n.question.code)){var i;return _.isEmpty(n.mobile.mobile)&&_.isEmpty(n.question.password_question)?i="none":_.isEmpty(n.mobile.mobile)||_.isEmpty(n.question.password_question)?_.isEmpty(n.question.password_question)?_.isEmpty(n.mobile.mobile)||(i="mobile"):i="question":i="both",t._hideLoading(s),e.success&&e.success(i,n),void 0}t._hideLoading(s),e.error&&e.error()},function(){t._hideLoading(s),e.error&&e.error()})),void 0)}var i=S.SSCT.GetHandler("Controller","AccountManage"),t=this,s=t._showLoading();t._retryLoadingElem=s,n.call(this)},_showLoading:function(){var e=S.common.ui.NoticeBox.loading();return e},_hideLoading:function(e){S.common.ui.NoticeBox.hide(e,null,"remove")},preBind:function(e,n){function i(n,i,t){this.enterType=e,"usercenter"===this.enterType&&this.setPageState(n,i),this.preBindRender(e)}S.SCEV.Proxy.trigger(S.SCEV.EventType.PRE_ROUTE,{enterPage:sdk.Log.businesses.PAGE_USER,enterBusiness:["preBind",e]});var t=sdk.PageCache.get("risk"),s=sdk.PageCache.get("secrecy_binding_mobile"),o=this,a=t.success?t.data:void 0,n=n||"mobile";sdk.PageCache.del("risk"),sdk.PageCache.del("secrecy_binding_mobile"),this._isStop=!1,"usercenter"!==e||t.success&&t.data&&"fail"!==t.data?(this.$el.find("#preBindCon").removeClass("ms-none"),i.call(this,a,s&&s.success?s.data:"",n)):this._getSecStateRetry({success:function(e,t){o.$el.find("#preBindCon").removeClass("ms-none"),i.call(o,e,t.mobile.mobile,n)},error:function(){o.$el.find("#preBindCon").removeClass("ms-none"),o._renderBindingFail()}}),this.initBackBtnEvent()},preBindRender:function(e){var n=this.$el.find("#bindNoticeMsg");"pwFalse"==e?n.html("我们发现您曾经出现密码错误，为了让您在忘记密码后能顺利找回，建议："):"paid"==e?n.html("您已完成支付，如果丢失账号、密码，则可能造成损失，因此我们强烈建议您："):"loginpage"==e?n.html("您已多次使用本账号进行游戏，为避免丢失账号、密码后可能造成的损失，建议："):"usercenter"==e&&n.html("数据显示，80%以上丢账号未能及时找回的玩家，都是因为未绑定手机所致。"),_.isUndefined($("#mobile").val())||""==$("#mobile").val()||this.$el.find("#mobile").val("")},bind:function(){S.Log.pageClose(),S.SCEV.Proxy.trigger(S.SCEV.EventType.PRE_ROUTE,{enterPage:sdk.Log.businesses.PAGE_USER,enterBusiness:["bind"]});var e=S.SSCT.GetHandler("Controller","General"),n=e.getCacheData("mobile",!0),i=this.getUserInfo().ucid,t=this.$el.find("#validCode"),s=this.$el.find("#bindPass");if(_.isUndefined(t.val())||""==t.val()||t.val(""),_.isUndefined(s.val())||""==s.val()||s.val(""),this.getUserInfo().isRandomPassword)s.val(this.getUserInfo().randomPassword),this.showRandomPassNotice();else{var o=S.SSCT.GetHandler("Controller","General").getCacheData("user_info_"+i,!0);o&&o.random&&(s.val(o.password),this.showRandomPassNotice())}this._initPopbox.call(this);var a="UC账号:";S.global.otherChannel&&(a=S.global.channelSetting.name+"账号:"),this.$el.find("#bindInfo").html(template.render("bindingInfoTempl",{ucid:i,mobile:n,accountName:a})),this.sendMsg()},securityQuestions:function(e){this.enterType=e,S.SCEV.Proxy.trigger(S.SCEV.EventType.PRE_ROUTE,{enterPage:sdk.Log.businesses.PAGE_USER,enterBusiness:["preBind_question",this.enterType]});var n=this.getUserInfo().ucid;"usercenter"===e?this.$el.find("#setQuestionNoti").html("设置密保问题后，忘记密码可通过此方式找回密码。"):this.$el.find("#setQuestionNoti").html("您还可以设置密保问题，忘记密码时，可通过此方式找回。"),this.initQuestionList(),this._initPopbox.call(this),this.$el.find("#passwordQuestion").val(this.config.questionList[0]);var i=this.$el.find("#passwordAnswer");if(_.isUndefined(i.val())||""==i.val()||i.val(""),this.getUserInfo().isRandomPassword)this.$el.find("#questionPass").val(this.getUserInfo().randomPassword);else{var t=S.SSCT.GetHandler("Controller","General").getCacheData("user_info_"+n,!0);t&&t.random&&this.$el.find("#questionPass").val(t.password)}},sendMsg:function(){this.btnCountDown();var e=S.SSCT.GetHandler("Controller","General"),n=e.getCacheData("mobile",!0),i={mobile:n},t=this;this.controller.sendCode2Mobile(i,this.controller.callBackMix(null,function(e){t.cancelBtnCountDown(),t._showErrorMsg("发送验证码失败: "+e)}))},btnCountDown:function(){"undefined"!=typeof secrecyTimeId&&null!=secrecyTimeId&&(clearInterval(secrecyTimeId),secrecyTimeId=null);var e=this.config.btnLockTime,n=this,i=this.$el.find("#resendBtn");i.val(e+" 重新获取"),i.removeClass("clickAble"),secrecyTimeId=setInterval(function(){--e<0?n.cancelBtnCountDown():i.val(e+" 重新获取")},1e3)},cancelBtnCountDown:function(){clearInterval(secrecyTimeId),secrecyTimeId=null;var e=this.$el.find("#resendBtn");e.val("重新获取"),e.addClass("clickAble")},_flushInpt:function(e){_.isEmpty($(e.target).val())&&$(e.target).val(""),this._hideErrorMsg()},getUserInfo:function(){var e=e?e:S.SSCT.GetHandler("Controller","User"),n=this,i=e.getCurUser();return(_.isEmpty(i)||i=={})&&e.getCurUserInfo(e.callBackMix(function(e){i=e},function(){n._showErrorMsg("获取用户信息失败")})),i},initQuestionList:function(){var e='<option value="-1">请选择密保问题</option>';this.config.questionList.map(function(n){e+="<option value="+n+">"+n+"</option>"}),e+='<option value="0">自定义问题</option>',this.$el.find("#questionList").html(e)},beforeBoxShowed:function(){var e=this;this.$el.find("#modifyPassMask").height($(window).height()+150),$(window).on("resize",function(){e.$el.find("#modifyPassMask").height($(window).height()+150)}),_.delay(function(){sdk.EC.hideInput()},50)},changeNumberHandle:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_changeNum_b"]),this.setRouteType("#!secrecy/preBind")},setRouteType:function(e){var n=this.enterType||"";this.$el.find("#bindPhoneCnt"),this.$el.find("#setQuestionCnt"),S.Url.location.route(e+"/"+n)},_showErrorMsg:function(e){var n=S.SSCT.GetHandler("Controller","General");n.sendClientMsg(e)},_hideErrorMsg:function(e){e=_.isUndefined(e)||_.isEmpty(e)?"slide":e,_.isUndefined(this.noticeBar)||_.isEmpty(this.noticeBar)||("remove"==e?S.common.ui.NoticeBox.hide(this.noticeBar,null,"remove"):S.common.ui.NoticeBox.hide(this.noticeBar,null,"slide"))},_showLoading:function(){var e=S.common.ui.NoticeBox.loading();return e},_hideLoading:function(e){S.common.ui.NoticeBox.hide(e,null,"remove")},hideFeedBack:function(e){$(e).addClass("btnClick-none")},addFeedBack:function(e){$(e).removeClass("btnClick-none")},hideRandomPassNotice:function(){this.$el.find("#randomPassNotice").addClass("ms-vshid")},showRandomPassNotice:function(){this.$el.find("#randomPassNotice").removeClass("ms-vshid")}});S.SSVW.Sso=Backbone.View.extend({el:"#userContainer",events:{"onclick #username,#password,#newPassword,#captchaInput":"_flushInpt","input #password":"_passwordValueChange","onclick #loginBut":"loginSubmit","onclick #registerBut":"register","onclick #forgetPassBtn":"forgetPassword","onclick #mobileBindingBtn":"bindMobile","onclick #registerReturnGameBtn":"returnGameAndLogin","onclick #gameLoginReturnGameBtn":"returnGameAndLogin","onclick #gameLoginBtn":"gotoGameLogin","onclick #backBtn":"goBack","onclick #modifyAndLoginBtn":"loginPageModifyAndLogin","onclick #forceModifyAndLoginBtn":"forceModifyAndLogin","onclick #bindModifyAndLoginBtn":"bindModifyAndLogin","onclick #useUCAccountLogin":"useUCAccountLogin","onclick #isNerverNotice":"checkNerverNotice","change #loginHistory":"selectHis","onclick #updatePassBtn":"_setUpdatePassParam","onclick #cancelLogin":"cancelUCAccountLogin","onclick #neverUpdateBtn":"neverUpdatePass","onclick #cancelModify":"cancelModify","onclick #agreementBtn":"gotoAgreement","onclick #loginHistory":"logHist","onclick #closeNotice":"closeNotice","onclick #noticeBtn":"showNotice","onclick #modifyPassBtn":"modifyPassword","onclick #regSuccessContent":"hideModify","onclick #checkboxArea":"setAccAutoLogin","onclick #captchaBtn":"captchaLoginSubmit","onclick #captchaRefreshBtn":"refreshCaptcha"},accountType:0,randomPwd:!0,noticeId:"",model:{},resp:{},loginHist:[],loginCount:0,localConfig:{LOGIN_COUNT:15,SECURITY_TYPE:{UNSECURITY:0,SECURITY:1}},loginLoadingEl:{},loginOptions:{},isNeedCaptcha:!1,isGettingCaptcha:!1,captchaForReg:!1,channelSetting:{name:"",accountName:"",loginLogo:""},checkedLastLoginTimeAccounts:"",initialize:function(){console.log(Math.floor(3*Math.random())),_.bindAll(this),this.controller=S.SSCT.GetHandler("Controller","Sso"),this.userController=S.SSCT.GetHandler("Controller","User"),this.generalController=S.SSCT.GetHandler("Controller","General"),this.accountType=this.controller.CONFIG.ACCOUNT_TYPE.LOGIN,this.$body=$("body");var e=S.global.versionCompare(S.global.version,rConfig.VERSIONS.SECURITY_VERSION);e!==!1&&e>=0?this.$body.data("ctrl","true"):this.$body.data("ctrl",""),this.channelSetting.name=S.global.channelSetting.name,this.channelSetting.accountName=S.global.channelSetting.name+"账号",this.channelSetting.loginLogo=S.global.channelSetting.login.headerLogo},closeNotice:function(){this.$body.removeClass("btnClick-none"),this.$el.find("#notice").addClass("ms-ni"),this._showLinkEffect()},showNotice:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_LoginNotice_l",this.noticeId]),this.$body.addClass("btnClick-none"),this.$el.find("#notice").removeClass("ms-ni"),this._hideLinkEffect("closeNotice")},login:function(e){-1!=navigator.userAgent.indexOf("Nexus 4")&&S.sdkBase.request(S.sdkBase.servType.APP,S.sdkBase.actions.OVERRIDE_BACK_BTN,{override:!1}),sdk.Log.click(sdk.Log.businesses.PAGE_USER,["sso"],!0),sdk.PageCache.del("auto_login_info"),this.accountType=this.controller.CONFIG.ACCOUNT_TYPE.LOGIN,this.controller.clearHistFlag();var s=e,t=sdk.PageCache.get("auto_login_info"),i=this,o=this.controller.getLoginConfig(),n=o.allowGameLogin,a=o.gameAccountTitle,c=o.isAutoLogin;this.displayContentByChannel(),c===!1?this.$el.find("#iconCheckbox").removeClass("on"):this.$el.find("#iconCheckbox").addClass("on"),a=_.isUndefined(a)||null===a||0===a.length?rConfig.user.defaultGameName:a;var d=ucf.Cache.get("game_notice",!0)||{},r=this.$el.find("#noticeBtn"),l=this.$el.find("#noticeTtl"),h=this.$el.find("#noticeWrapper");_.isUndefined(d.content)||(r.html(d.content).removeClass("gr-vshid"),l.html(d.content),h.html(d.contentDetail),this.noticeId=d.msgId,sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_LoginNotice_p",d.msgId])),this.controller.getGameNotice({success:function(e){_.isUndefined(e)||(_.isUndefined(d.content)||0==parseInt(e.priority))&&(r.html(e.content).removeClass("gr-vshid"),l.html(e.content),h.html(e.contentDetail),i.noticeId=e.msgId,sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_LoginNotice_p",e.msgId]))},error:function(){}});var g=this.$el.find("#gameLoginBtn");g.html(a+"老账号登录"),this.$el.find("#showHistory").removeClass("ms-ni"),n===!0&&S.global.otherChannel!==!0&&g.removeClass("ms-none"),this.versionFixing(),this.$body.removeClass("btnClick-none"),this.$el.find("#registerBut").val("一键注册").data("type","login"),this.$el.find("#forgetPassBtn").removeClass("ms-ni"),this.$el.find("#gameLoginBottom").addClass("ms-ni"),this.$el.find("#normalLoginBottom").removeClass("ms-ni"),t&&t.success&&t.data?this._setHistory(t.data.account,t.data.password,t.data.securityType):s?this._setHistory(s):this._setHistory(),this._restoreRegSuccWin()},gameLogin:function(){S.SCEV.Proxy.trigger(S.SCEV.EventType.PRE_ROUTE,{enterPage:sdk.Log.businesses.PAGE_USER,enterBusiness:["oldAccountLogin"]}),this.versionFixing();var e=this.controller.getLoginConfig(),s=e.isAutoLogin;s===!1?this.$el.find("#iconCheckbox").removeClass("on"):this.$el.find("#iconCheckbox").addClass("on");var t=e.gameAccountTitle;t=_.isUndefined(t)||null===t||0===t.length?rConfig.user.defaultGameName:t,this.setUsername(""),this.setLastLoginTime(-1),this.setPassword(""),this.$body.removeClass("btnClick-none"),this.accountType=this.controller.CONFIG.ACCOUNT_TYPE.GAME_LOGIN,this.$el.find("#loginTitleTabs").html('<a class="item">'+t+'老账号</a><p class="btnBox"><a href="javascript:;" id="backBtn" class="fl btn btn_dark back_btn">'+this.channelSetting.accountName+"</a></p>"),this.$el.find("#username").attr("placeholder",t),this.$el.find("#registerBut").val("注册"+this.channelSetting.accountName).data("type","gameLogin"),this.$el.find("#forgetPassBtn").addClass("ms-ni"),this._setHistory(),this.$el.find("#normalLoginBottom").addClass("ms-ni"),this.$el.find("#gameLoginBottom").removeClass("ms-ni"),this.$el.find("#showHistory").addClass("ms-ni");var i=sdk.PageCache.get("login_param");if(i.success&&i.data){var o=i.data.account,n=i.data.password,a=i.data.randomPassword;a?this._setRegSuccPopup(o,a,!0,!1):this._setRegSuccPopup(o,n,!0,!0)}this._restoreRegSuccWin()},versionFixing:function(){var e=S.global.versionCompare(S.global.version,rConfig.VERSIONS.AUTO_LOGIN_VERSION);e!==!1&&e>=0?this.$el.find("#checkboxArea").removeClass("ms-ni"):this.$el.find("#checkboxArea").addClass("ms-ni");var s=S.global.versionCompare(S.global.version,rConfig.VERSIONS.LOGIN_WIDGET_VERSION);s!==!1&&s>=0?(this.$el.find("#agreementLinkCon").addClass("ms-none"),this.$el.find("#regAgree").removeClass("ms-none"),this.$el.find("#registerReturnGameBtn").val("立即登录"),this.$el.find("#gameLoginReturnGameBtn").val("立即登录")):(this.$el.find("#agreementLinkCon").removeClass("ms-none"),this.$el.find("#regAgree").addClass("ms-none"),this.$el.find("#registerReturnGameBtn").val("进入游戏"),this.$el.find("#gameLoginReturnGameBtn").val("进入游戏"))},loginSubmit:function(){this.accountType===this.controller.CONFIG.ACCOUNT_TYPE.GAME_LOGIN?sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_oldidlogin_b"]):sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_login_b"]);var e=this,s="您正在登录的"+this.channelSetting.accountName+"已与游戏账号绑定，角色信息完全一样",t=this.accountType,i=this.$el.find("#username").val(),o=this.$el.find("#password").getInp(),n=this.$el.find("#password").isModify(),a=this.$el.find("#iconCheckbox").hasClass("on"),c=this.getLastLoginTime(i);securityType=n?this.localConfig.SECURITY_TYPE.UNSECURITY:this.localConfig.SECURITY_TYPE.SECURITY,vc=S.global.versionCompare(S.global.version,rConfig.VERSIONS.SECURITY_VERSION),isSecurity=!1,this.accountType===this.controller.CONFIG.ACCOUNT_TYPE.GAME_LOGIN&&(s="您正在使用"+this.channelSetting.accountName+"登录，此账号还能在所有UC和九游产品中使用"),vc!==!1&&vc>=0&&securityType===this.localConfig.SECURITY_TYPE.SECURITY&&(isSecurity=!0),this.controller.validLoginData(i,o,t,{isSecurity:isSecurity},this.controller.callBackMix(function(i,o){if(e.loginOptions={loadingMsg:s,account:i,password:o,accountType:t,rememberPassword:!0,isAutoLogin:a,securityType:securityType},e._isLoginStateInvalid(i,c))return e._showErrorMsg("账号登录信息已过期，请重新输入密码"),e.setPassword(""),void 0;var n=sdk.PageCache.get("isCheckCaptcha_"+i);return n.success&&1===n.data?(e._showCaptchaPopup(),void 0):(e._loginSubmitInner(),void 0)},function(s){if(105==s.code||102==s.code){e.$el.find("#password").setInp("");var t=ucf.Cache.get("wrong_password_ucids",!0)||{},i=e.$el.find("#username").val();t[i]=1,ucf.Cache.set("wrong_password_ucids",t,0,!0)}e._showErrorMsg(s.msg)}))},captchaLoginSubmit:function(){var e=this.$el.find("#captchaInput"),s=e.val();s=s.replace(/^\s+/g,"").replace(/\s+$/g,""),_.isEmpty(s)?this._showErrorMsg("请输入验证码"):(this.loginOptions.captcha=s,this.captchaForReg?this._loginSubmitForRegInner():this._loginSubmitInner())},_loginSubmitForRegInner:function(){var e=this,s=e.loginOptions.account,t=e.loginOptions.password,i=e.loginOptions.isAutoLogin,o={account:s,password:t,isAutoLogin:i},n=e._showLoading();_.isUndefined(this.loginOptions.captcha)||_.isEmpty(this.loginOptions.captcha)||(o.captcha=e.loginOptions.captcha),e.controller.loginSubmit(o,!1,e.controller.callBackMix(function(s){e._hideLoading(n),ucf.Cache.set("openTestGame_"+o,s.get("openTestGame"),3600,!0),ucf.Cache.set("isAlpha_"+o,s.get("isAlpha"),3600,!0);var t=s.get("isCheckCaptcha");1==t?sdk.PageCache.set("isCheckCaptcha_"+o,t):sdk.PageCache.del("isCheckCaptcha_"+o),sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_ucidbindgame_b"]);var i=e.$el.find("#ucAccount"),o=i.attr("data-value"),a=i.attr("data-acType");e.doLoginCheck(a,o),sdk.PageCache.del("login_param")},function(t,i){e._hideLoading(n),_.isUndefined(i.data)||_.isUndefined(i.data.isCheckCaptcha)||1!=i.data.isCheckCaptcha?sdk.PageCache.del("isCheckCaptcha_"+s):sdk.PageCache.set("isCheckCaptcha_"+s,i.data.isCheckCaptcha);var o="登录失败";o=13==i.code?"请输入验证码":i.msg||o,12==i.code&&e.refreshCaptcha(),e._showErrorMsg(o)}))},_loginSubmitInner:function(){var e=this,s=e.loginOptions.loadingMsg,t=e.loginOptions.account,i=e.loginOptions.password,o=e.loginOptions.accountType,n=(e.loginOptions.rememberPassword,e.loginOptions.isAutoLogin),a=e.loginOptions.securityType,c={account:t,password:i,accountType:o,rememberPassword:!0,isAutoLogin:n,securityType:a};_.isUndefined(this.loginOptions.captcha)||_.isEmpty(this.loginOptions.captcha)||(c.captcha=e.loginOptions.captcha),this.loginLoadingEl=e._showLoading(s),this.controller.loginSubmit(c,!0,e.controller.callBackMix(function(s,n){e._hideCaptchaPopup();var a,c,d;ucf.Cache.set("openTestGame_"+s.get("ucid"),s.get("openTestGame"),86400,!0),ucf.Cache.set("isAlpha_"+s.get("ucid"),s.get("isAlpha"),86400,!0);var r=s.get("isCheckCaptcha");1==r?sdk.PageCache.set("isCheckCaptcha_"+t,r):sdk.PageCache.del("isCheckCaptcha_"+t),e.isNeedCaptcha&&sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_captcha_login_success"]),e.$el.find("input").addClass("btnClick-none"),e.userController.getCurUserInfo(e.userController.callBackMix(function(s){d=s,a=s.ucid,c=e.generalController.getCacheData("user_info_"+s.ucid,!0);var t=s.password||s.randomPassword;c&&c.random&&t!=c.password&&e.generalController.setCacheData("user_info_"+s.ucid,{random:!1},0,!0)}));var l=ucf.Cache.get("wrong_password_ucids",!0);if(a&&l&&l[t])return delete l[t],ucf.Cache.set("wrong_password_ucids",l,0,!0),e.controller.updateLoginCount(t),e.toSecrecyPage(o,t,function(){e.doLoginSuccess(s,n)},1,e.loginLoadingEl),void 0;var h,g=!0;if(e.loginCount=e.controller.getLoginCount(a),c=e.generalController.getCacheData("user_info_"+a,!0),c&&(d.isRandomPassword=c.random,d.randomPassword=d.isRandomPassword?c.password:d.randomPassword),sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_randomPw_i"]),o==e.controller.CONFIG.ACCOUNT_TYPE.LOGIN&&!0===d.isRandomPassword)e._hideLoading(e.loginLoadingEl),e.controller.updateLoginCount(d.ucid),e.loginCount<=3?e.doLoginCheck(o,t):e._showUpdateRandomPassBox({accountType:o,account:d.ucid,randomPassword:d.randomPassword,isUCLogin:!0});else if(c||(isNaN(i)||8!=i.toString().length)&&(11!=i.toString().length||"UCX"!=i.substr(0,3)||isNaN(i.substr(3,i.toString().length-3))))e.doLoginSuccess(s,n);else{sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_speciallyPw"]);var u,m,p=e.loginHist,f=p.length;if(0!==f&&!_.isUndefined(p[0]))for(var C=0;f>C;C++)if(u=p[C],u.account==t){m=u.lastLoginTime;var k=(new Date).valueOf();h=(parseInt(k)-parseInt(m))/864e5,2>h&&(g=!1);break}h&&g?(e._hideLoading(e.loginLoadingEl),e.model=s,e.resp=n,sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_overtimePw_w"]),e._showPopBox(template.render("forceUpdateRandomPassBoxTempl"),function(){var s=e.$el.find("#updateHint");s.html("您已"+Math.floor(h)+"天未登陆本账号，为了您的账号安全，请重新输入密码"),s.attr({account:t,accountType:o,password:i})})):e.doLoginSuccess(s,n)}},function(s,i){e._hideLoading(e.loginLoadingEl),_.isUndefined(i.data)||_.isUndefined(i.data.isCheckCaptcha)||1!=i.data.isCheckCaptcha?sdk.PageCache.del("isCheckCaptcha_"+t):sdk.PageCache.set("isCheckCaptcha_"+t,i.data.isCheckCaptcha);var o="";if(o=13==i.code?"请输入验证码":i.msg,e._showErrorMsg(o),12==i.code||13==i.code||-3==i.code&&-5==esp.code&&e.isNeedCaptcha===!0)12==i.code?e.refreshCaptcha():13==i.code&&e._showCaptchaPopup();else if(e._hideCaptchaPopup(),101==i.code){e.$el.find("#password").setInp("");var n=ucf.Cache.get("wrong_password_ucids",!0)||{},a=s.get("account");n[a]=1,ucf.Cache.set("wrong_password_ucids",n,0,!0)}}))},doLoginSuccess:function(e){var s=e.get("account"),t=e.get("password"),i=e.get("accountType"),o=(e.get("rememberPassword"),this),n={};this.userController.getCurUserInfo(this.userController.callBackMix(function(e){n=e},function(){o.userController.sdkExit()}));var a=this.generalController.getCacheData("user_info_"+n.ucid,!0);a&&(n.isRandomPassword=a.random,n.randomPassword=n.isRandomPassword?a.password:n.randomPassword);var c=!(!1===n.isRandomPassword||0===n.randomPassword.length),d=ucf.Cache.get("login_binding_info",!0)||{};if(i===this.controller.CONFIG.ACCOUNT_TYPE.GAME_LOGIN&&d[s]!==!0){d[s]=!0,ucf.Cache.set("login_binding_info",d,0,!0);var r=n.ucid,l=n.randomPassword;c?this.controller.validSecrecy(i,s,this.controller.callBackMix(function(){o._hideLoading(o.loginLoadingEl),sdk.PageCache.set("login_param",{accountType:o.controller.CONFIG.ACCOUNT_TYPE.LOGIN,account:r,password:t,randomPassword:l}),o._setRegSuccPopup(r,l,!0)},function(){o._hideLoading(o.loginLoadingEl),o.userController.checkNoticeInfo(n.ucid,"updatePassword")?o.doLoginCheck(i,s):o._showUpdateRandomPassBox({accountType:o.controller.CONFIG.ACCOUNT_TYPE.LOGIN,account:n.ucid,randomPassword:n.randomPassword})})):this.existUCAccount()}else i===this.controller.CONFIG.ACCOUNT_TYPE.GAME_LOGIN?this.existUCAccount(i,n.ucid):(o._hideLoading(o.loginLoadingEl),this.controller.updateLoginCount(n.ucid),this.doLoginCheck(i,n.ucid))},register:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_sign_b"]),S.SCEV.Proxy.trigger(S.SCEV.EventType.PRE_ROUTE,{enterPage:sdk.Log.businesses.PAGE_USER,enterBusiness:["register"]});var e=this._randomPassword(),s=this._showLoading(),t=this;this.userController.register({password:e,isRandomPassword:!0,agree:!0},this.userController.callBackMix(function(i){function o(){t._hideLoading(s),t._setRegSuccPopup(i.get("ucid"),e,!1),"gameLogin"==t.$el.find("#registerBut").data("type")?sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_sign_w_GameAccount"]):sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_sign_w_UCAccount"])}function n(){t.controller.loginSubmit(a,!0,t.controller.callBackMix(function(i){t._hideLoading(s),ucf.Cache.set("openTestGame_"+i.get("ucid"),i.get("openTestGame"),3600,!0),ucf.Cache.set("isAlpha_"+i.get("ucid"),i.get("isAlpha"),3600,!0),"gameLogin"==t.$el.find("#registerBut").data("type")?sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_sign_w_GameAccount"]):sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_sign_w_UCAccount"]),t._setRegSuccPopup(i.get("ucid"),e,!1)},function(e,i){t._hideLoading(s),t._showErrorMsg(i.msg||"登录失败")}))}t.generalController.setCacheData("user_info_"+i.get("ucid"),{random:!0,password:e},0,!0);var a={account:i.get("ucid"),isAutoLogin:!0,password:e};S.global.versionCompare(S.global.version,rConfig.VERSIONS.LOGIN_WIDGET_VERSION)>=0?(t.$el.find("#registerReturnGameBtn").data("regType","registerOnly"),o.call(t)):(t.$el.find("#registerReturnGameBtn").data("regType","registerAndLogin"),n.call(t))},_.bind(function(e){t._hideLoading(s),t.generalController.sendClientMsg(e)},this)),!0)},doLoginCheck:function(e,s,t){function i(){if(a&&a.status&&"B"==a.status)return sdk.Url.redirect("../game/game.html#!game/notOpen/"+encodeURIComponent(a.message)),void 0;if(c)sdk.Url.redirect("../game/game.html#!game/validCode/false");else{if(t)return t.apply(o),void 0;o.userController.sdkExit()}}var o=this,n=this.userController.getCurUser().ucid,a=ucf.Cache.get("openTestGame_"+n,!0),c=ucf.Cache.get("isAlpha_"+n,!0),d=this.controller.getLoginCount(n);e==this.controller.CONFIG.ACCOUNT_TYPE.LOGIN&&d==this.localConfig.LOGIN_COUNT?this.toSecrecyPage(e,s,function(){i()}):i()},bindMobile:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_ucidbindphone_b"]),sdk.Log.pageEnter(sdk.Log.businesses.PAGE_USER,["bindSecrecyMobile"]),sdk.Url.location.route("#!secrecy/preBind/ucidbindpage")},returnGame:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_ucidbindgame_b"]);var e=this.$el.find("#ucAccount"),s=e.attr("data-value"),t=e.attr("data-acType");this.doLoginCheck(t,s),sdk.PageCache.del("login_param")},firstGameLogin:function(){S.SCEV.Proxy.trigger(S.SCEV.EventType.PRE_ROUTE,{enterPage:sdk.Log.businesses.PAGE_USER,enterBusiness:["firstGameLogin"]});var e=sdk.PageCache.get("login_param");if(e.success&&e.data){var s=e.data.account,t=e.data.accountType,i=e.data.randomPassword,o=this.$el.find("#ucAccount"),n=this.$el.find("#randomPassword");o.html(s),o.attr({"data-value":s,"data-acType":t}),n.attr("data-value",i),n.html(i)}},returnGameAndLogin:function(e){this._setElementDisabledOrEnable(!0);var s=$(e.target);if("true"===s.data("returngame")){var t,i,o=this,n=!0;"registerNow"===s.data("regType")?(t=this.$el.find("#regNowUcAccount").data("ucid"),i=this.$el.find("#regNowPassword").data("password"),n=this.$el.find("#regNowIconCheckbox").hasClass("on")):(t=this.$el.find("#regUcAccount").data("ucid"),i=this.$el.find("#regPassword").data("password"));var a=o._showLoading(),c={account:t,password:i,isAutoLogin:n};o.controller.loginSubmit(c,!1,o.controller.callBackMix(function(e){o._hideLoading(a),ucf.Cache.set("openTestGame_"+t,e.get("openTestGame"),3600,!0),ucf.Cache.set("isAlpha_"+t,e.get("isAlpha"),3600,!0);var s=e.get("isCheckCaptcha");1==s?sdk.PageCache.set("isCheckCaptcha_"+t,s):sdk.PageCache.del("isCheckCaptcha_"+t),sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_ucidbindgame_b"]);var i=o.$el.find("#ucAccount"),n=i.attr("data-value"),c=i.attr("data-acType");o.doLoginCheck(c,n),sdk.PageCache.del("login_param")},function(e,s){o._hideLoading(a),_.isUndefined(s.data)||_.isUndefined(s.data.isCheckCaptcha)||1!=s.data.isCheckCaptcha?sdk.PageCache.del("isCheckCaptcha_"+t):sdk.PageCache.set("isCheckCaptcha_"+t,s.data.isCheckCaptcha);var i="登录失败";13==s.code?(i="请输入验证码",o.$el.find("#regSuccessPopup").addClass("ms-none"),o.loginOptions=c,o.captchaForReg=!0,o._showCaptchaPopup()):i=s.msg||i,o._showErrorMsg(i)}))}},bindModifyAndLogin:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_ucidbindmodifypwok_b"]),this.modifyAndLogin()},loginPageModifyAndLogin:function(){this.accountType===this.controller.CONFIG.ACCOUNT_TYPE.LOGIN?(sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_loginmodifypwok_b"]),sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_randomPw_modify_b"])):sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_oldidbindmodifypwok_b"]);var e=this.$el.find("#randomPwdRemind").html().substr(0,5);"你使用的是"==e?sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_randomPw_modify_i_opt"]):"随机密码已"==e&&sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_randomPw_modify_i_force"]),this.modifyAndLogin()},forceModifyAndLogin:function(){var e=this.$el.find("#updateHint"),s=this.$el.find("#forcePassword"),t=e.attr("account"),i=(e.attr("accountType"),e.attr("password")),o=s.val(),n=s.attr("type"),a=this;if("password"==n)if(i==o)this.generalController.setCacheData("user_info_"+t,{random:!1},0,!0),this._hidePopBox(),this.doLoginSuccess(this.model,this.resp);else{sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_retypePw_w"]);var c=this.$el.find("#forcePwd");c.html(""),c.append('<input id="forcePassword"  type="text" class="input_box" placeholder="重新输入密码" />'),e.html("密码错误，请确认后重新输入")}else sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_overtimePw_b"]),S.SSCT.GetHandler("Controller","User").updatePass({oldPassword:i,password:o,isPostPass:!0},S.SSCT.GetHandler("Controller","User").callBackMix(function(){a._hidePopBox(),a.doLoginSuccess(a.model,a.resp)},function(e){a._showErrorMsg(e,"#loginSuccessNoticeBox")}))},modifyAndLogin:function(){var e=this,s=this.$el.find("#accountParam"),t=this.$el.find("#newPassword").val(),i=s.attr("data-value"),o=s.attr("data-acType"),n=s.attr("data-password"),a="callback"===this.$el.find(".modifyAndLoginBtn").attr("data-callback")?!0:!1;S.SSCT.GetHandler("Controller","User").updatePass({oldPassword:n,password:t,isPostPass:!0},S.SSCT.GetHandler("Controller","User").callBackMix(function(){var s;a&&(s=function(){e.$el.find("#passwordLabel").html("密码");var s=e.$el.find("#randomPassword");s.html(t),s.attr("data-value",t),e._hidePopBox()}),e.doLoginCheck(o,i,s)},function(s){e._showErrorMsg(s,"#loginSuccessNoticeBox")}))},existUCAccount:function(){this._hideLoading(this.loginLoadingEl),this._showExsitAccountBox()},toSecrecyPage:function(e,s,t,i,o){var n=this;if(!o)var a=this._showLoading();this.controller.validSecrecy(e,s,this.controller.callBackMix(function(){o?n._hideLoading(o):n._hideLoading(a),sdk.Log.pageEnter(sdk.Log.businesses.PAGE_USER,["bindSecrecyMobile"]),1==i?sdk.Url.location.route("#!secrecy/preBind/pwFalse"):sdk.Url.location.route("#!secrecy/preBind/loginpage")},function(){o?n._hideLoading(o):n._hideLoading(a),t()}))},checkNerverNotice:function(){var e=this.$el.find("#isNerverNotice");"checked"===e.attr("data-value")?(e.attr("data-value",""),e.removeClass("cbbg")):(e.attr("data-value","checked"),e.addClass("cbbg"))},useUCAccountLogin:function(){var e=this.userController.getCurUser(),s=this.generalController.getCacheData("user_info_"+e.ucid,!0);s&&(e.isRandomPassword=s.random,e.randomPassword=e.isRandomPassword?s.password:e.randomPassword);var t=!(!1===e.isRandomPassword||0===e.randomPassword.length);t?this.userController.checkNoticeInfo(e.ucid,"updatePassword")?this.doLoginCheck(this.controller.CONFIG.ACCOUNT_TYPE.GAME_LOGIN,e.ucid):this._showUpdateRandomPassBox({accountType:this.controller.CONFIG.ACCOUNT_TYPE.GAME_LOGIN,account:e.ucid,randomPassword:e.randomPassword}):this.doLoginCheck(this.controller.CONFIG.ACCOUNT_TYPE.GAME_LOGIN,e.ucid)},setUsername:function(e){this.$el.find("#username").val(e)},setLastLoginTime:function(e){_.isUndefined(e)&&(e=-1),this.$el.find("#username").attr("lastLoginTime",e)},getLastLoginTime:function(e){var s=-1,t=this.$el.find("#username");return t.val()==e&&(_.isUndefined(t.attr("lastLoginTime"))||_.isEmpty(t.attr("lastLoginTime"))||(s=t.attr("lastLoginTime"))),s},setPassword:function(e,s){this.$el.find("#password").setInp(e).setModify(s)},logHist:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_otherid_b"])},selectHis:function(){var e=document.querySelector("#loginHistory"),s=e.options[e.selectedIndex],t=s.value,i=t||this.$el.find("#loginHistory").val();if("-1"!=i){var o={};this.controller.getHistByUsername(i,this.accountType,this.controller.callBackMix(function(e){o=e})),this._setAccount({account:o.account,password:o.password,isRandomPassword:o.isRandomPassword,lastLoginTime:o.lastLoginTime}),this._setAccountCheckedLastLoginTime(o.account,!1)}},checkRememPassword:function(e){var s,t=e.target,i=t.getAttribute("data-checked");"checked"===i?(s="",$(t).removeClass(this.localConfig.checkedClass)):(s="checked",$(t).addClass(this.localConfig.checkedClass)),t.setAttribute("data-checked",s)},resetUsername:function(){this.setUsername(""),this.setLastLoginTime(-1),this.resetPassword()},resetPassword:function(){this.setPassword("")},cancelUCAccountLogin:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_oldidbindpass_b"]);var e=this.userController.getCurUser();this.userController.setNerverNotice(e.ucid,!0),this.doLoginCheck(this.controller.CONFIG.ACCOUNT_TYPE.GAME_LOGIN,e.ucid)},neverUpdatePass:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_randomPw_opt_no_l"]);var e=this.userController.getCurUser();this.$el.find(".btnClick-none").removeClass("btnClick-none"),this._hidePopBox(),this.doLoginCheck(this.accountType,e.ucid)},cancelModify:function(){this._hidePopBox()},forgetPassword:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_forgetpw_l"]),S.Url.location.route("#!findPassword/passwordRetake/messageRetake")},gotoAgreement:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_article_l"]),S.Url.location.route("#!user/agreement"),this.$el.find("#regSuccessPopup").hasClass("ms-none")||S.PageCache.set("sso_regSuccWin_params",this._popupParams),this.$el.find("#registerNowPopbox").isHide()||(this.$el.find("#registerNowPopbox").suiHide(),S.PageCache.set("sso_is_regNowWin_show",!0))},gotoGameLogin:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_oldid_l"]),S.Url.location.route("#!sso/gameLogin"),sdk.PageCache.del("login_param")},goBack:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_oldidbinducid_b"]),S.Url.back()},_setHistory:function(e,s,t){var i=this,o={isRandomPassword:!1,account:"",password:"",lastLoginTime:-1};this._getHistData(_.bind(function(n){i.loginHist=n;var a=this.controller.getHistLength(this.accountType);if(0===a||_.isUndefined(n[0]))i.$el.find("#showHistory").removeClass("ms-block").addClass("ms-ni");else{a>1?i.$el.find("#showHistory").removeClass("ms-ni").addClass("ms-block"):i.$el.find("#showHistory").removeClass("ms-block").addClass("ms-ni");var c=null,d=document.createDocumentFragment(),r=new Option("请选择账号","-1");d.appendChild(r),console.log(JSON.stringify(n)),_.each(n,function(s){_.isEmpty(e)||s.account!==e||(c=s),d.appendChild(new Option(s.account,s.account))}),i.$el.find("#loginHistory").append(d),e&&s?c={isRandomPassword:!1,account:e,rememberPassword:!0,password:s}:e&&null===c?c={isRandomPassword:!1,account:e,rememberPassword:!1,password:""}:null===c&&(c=n[0]),o.isRandomPassword=c.isRandomPassword,o.account=c.account,o.lastLoginTime=c.lastLoginTime,c.rememberPassword&&(o.password=c.password)}i._setAccount({account:o.account,password:o.password,isRandomPassword:o.isRandomPassword,securityType:t,lastLoginTime:o.lastLoginTime})},this),!0)},_flushInpt:function(e){_.isEmpty($(e.target).val())?$(e.target).val(""):$(e.target).val($(e.target).val()),$(window).width()>$(window).height()},_setAccount:function(e){var s;this.setUsername(e.account),this.setLastLoginTime(e.lastLoginTime),1==e.securityType?s=!1:0==e.securityType&&(s=!0),this.setPassword(e.password,s)},_showLoading:function(e){var s=S.common.ui.NoticeBox.loading(e);return s},_textLoading:function(){var e=S.common.ui.NoticeBox.loading("loading_text");return e},_hideLoading:function(e){S.common.ui.NoticeBox.hide(e,null,"remove")},_getHistData:function(e,s){var t=this,i=this.controller.getHistories(this.accountType);_.isUndefined(i)||s===!0?this.controller.getHistory(this.accountType,this.controller.callBackMix(function(s){e&&e(s)},function(e){t._showErrorMsg(e,"#errorEl")})):e&&e(i)},_showUpdateRandomPassBox:function(e){e.accountType==this.controller.CONFIG.ACCOUNT_TYPE.LOGIN?(sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_loginmodifypw_w"]),sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_randomPw_modify_w"])):sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_oldidbindmodifypw_w"]),this.$el.find("input").addClass("btnClick-none");var s=this;this._showPopBox(template.render("updateRandomPassBoxTempl"),function(){s.loginCount<=10?(sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_randomPw_opt_w"]),s.$el.find("#randomPwdRemind").html('你使用的是随机密码<em style="color:red;font-weight:bold;">(还可以使用'+(10-parseInt(s.loginCount))+"次)</em>，为了你的账号安全，请及时修改。")):(sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_randomPw_force_w "]),s.$el.find("#randomPwdRemind").html("随机密码已到期，请设置密码后进入游戏。"),s.$el.find("#neverUpdateBtn").addClass("ms-none")),s.$el.find("#accountParam").attr({"data-value":e.account,"data-acType":e.accountType,"data-password":e.randomPassword})})},_setUpdatePassParam:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_ucidbindmodifypw_b"]);var e=this.$el.find("#ucAccount");$("input").addClass("btnClick-none");var s=e.attr("data-value"),t=e.attr("data-acType"),i=this.$el.find("#randomPassword").attr("data-value");this._showUpdatePassBox({account:s,accountType:t,password:i})},_showUpdatePassBox:function(e){var s=this;this._showPopBox(template.render("updatePassBoxTempl"),function(){var t=s.$el.find("#accountParam");t.html(e.account),t.attr({"data-value":e.account,"data-acType":e.accountType,"data-password":e.password}),S.global.otherChannel&&s.$el.find("#updatePassBoxAcLb").html(this.channelSetting.accountName+":")})},_showExsitAccountBox:function(){var e=this.userController.getCurUser(),s=this.userController.checkNoticeInfo(e.ucid),t=this;s?this.doLoginCheck(this.controller.CONFIG.ACCOUNT_TYPE.GAME_LOGIN,e.ucid):(S.SCEV.Proxy.trigger(S.SCEV.EventType.PRE_ROUTE,{enterPage:sdk.Log.businesses.PAGE_USER,enterBusiness:["existUCAccount"]}),this._showPopBox(template.render("ownUCAccountBoxTempl"),function(){t.$el.find("#bindTitle").html("我们发现你的《"+e.gameName+"》游戏老账号和"+this.channelSetting.accountName+"曾经绑定过。"),t.$el.find("#bindUcid").html(this.channelSetting.accountName+"："+e.ucid),S.global.otherChannel&&(t.$el.find("#ownAccountBoxTitle").html("已绑定过"+this.channelSetting.accountName),t.$el.find("#useUCAccountLogin").val("使用"+this.channelSetting.accountName+"登录"))}))},_showPopBox:function(e,s){var t=this;this.$body.addClass("btnClick-none"),_.delay(function(){sdk.EC.hideInput(),t.$el.find("#popBox").html(e),t.$el.find("#popup").removeClass("ms-none"),t._autoResizeMask("modifyPassMask"),S.sdkBase.request(S.sdkBase.servType.APP,S.sdkBase.actions.OVERRIDE_BACK_BTN,{override:!0}),document.addEventListener("backbutton",function(){t._hidePopBox()}),s.apply(t)},50)},_hidePopBox:function(){sdk.EC.showInput(),this.$el.find("#popup").addClass("ms-none"),this.$body.removeClass("btnClick-none"),$(".btnClick-none").removeClass("btnClick-none"),$(window).off("resize"),S.sdkBase.request(S.sdkBase.servType.APP,S.sdkBase.actions.OVERRIDE_BACK_BTN,{override:!1}),document.removeEventListener("backbutton"),this._setElementDisabledOrEnable(!0)},_showErrorMsg:function(e){this.generalController.sendClientMsg(e)},_randomPassword:function(){return"UCX"+Math.random().toString().substr(2,8)},setAccAutoLogin:function(){var e=this.$el.find("#iconCheckbox");e.hasClass("on")?(e.removeClass("on"),sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_CloseAutoLogin_b","login"])):(e.addClass("on"),sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_OpenAutoLogin_b","login"]))},modifyPassword:function(){var e=this.$el.find("#modifyPassBtn"),s=this.$el.find("#regPassword"),t=this.$el.find("#newPasswordSpan"),i=this.$el.find("#passwordName"),o=this.$el.find("#modifyResult"),n=e.val(),a=this.$el.find("#registerBut").data("type");if("修改密码"==n)"gameLogin"==a?sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_sign_modifyPw_b_GameAccount"]):sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_sign_modifyPw_b_UCAccount"]),t.toggleClass("ms-ni"),s.toggleClass("ms-ni"),i.html("输入密码:"),e.val("    完成   "),o.css("color","grey"),o.html("点击空白区域可取消修改");else if("    完成   "==n){"gameLogin"==a?sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_sign_PwConfirm_b_GameAccount"]):sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_sign_PwConfirm_b_UCAccount"]);var c=this.$el.find("#newPassword"),d=c.val();if(c.val(""),o.html(""),d.length<6||d.length>20)return this.hideModify(),o.css("color","red"),o.html("密码格式错误！"),void 0;sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_signmodifypwok_b"]);
var r={isPostPass:!0,oldPassword:s.html(),password:d},l=this;l._hideLinkEffect(),this.userController.registerUpdatePass(r,this.controller.callBackMix(function(){o.css("color","#333333"),o.html("密码修改成功！"),t.toggleClass("ms-ni"),s.toggleClass("ms-ni"),i.html("账号密码:"),e.val("修改密码"),s.html(d).data("password",d),l._popupParams&&(l._popupParams[1]=d),l.randomPwd=!1;var n=l.$el.find("#regUcAccount").html();sdk.PageCache.set("login_param",{accountType:l.controller.CONFIG.ACCOUNT_TYPE.LOGIN,account:n,password:d,randomPassword:""}),l._hideLinkEffect()},function(e){l.hideModify(),o.css("color","red"),o.html(e)}))}},hideModify:function(e){if(!e||"modifyPassBtn"!=e.target.id&&"newPassword"!=e.target.id&&"returnGameBtn"!=e.target.id){this.$el.find("#newPasswordSpan").addClass("ms-ni"),this.$el.find("#regPassword").removeClass("ms-ni"),this.$el.find("#modifyPassBtn").val("修改密码");var s=this.$el.find("#passwordName");"账号密码:"!=s.html()&&(this.randomPwd?s.html("随机密码:"):s.html("账号密码:"),this.$el.find("#modifyResult").html("&nbsp;"))}},_restoreRegSuccWin:function(){var e=sdk.PageCache.get("sso_regSuccWin_params");e.success&&e.data&&(sdk.PageCache.del("sso_regSuccWin_params"),this._setRegSuccPopup.apply(this,e.data))},_setRegSuccPopup:function(e,s,t,i){if(this.$el.find("#regUcAccount").html(e).data("ucid",e),this.$el.find("#regPassword").html(s).data("password",s),this.$el.find("#registerReturnGameBtn").data("regType","firstGameLogin"),this.$el.find("#password").addClass("ms-ni"),this.$el.find("#username").addClass("gr-vshid"),this.$body.addClass("btnClick-none"),this.$el.find("#regSuccessPopup").removeClass("ms-none"),this._popupParams=[e,s,t,i],t){i&&this.$el.find("#passwordName").html("账号密码:");var o=this.$el.find("#gameNotice");o.css("margin","10px 10px -10px 15px"),o.css("color","grey"),o.html("为提供更好的游戏服务，我们为您分配了新的"+this.channelSetting.accountName+"。"),this.$el.find("#regSuccTitle").html("老账号绑定新"+this.channelSetting.accountName),this.$el.find("#regAgree").removeClass("ms-none")}this._setElementDisabledOrEnable(!1),this._autoResizeMask("regPopupMask")},_showCaptchaPopup:function(){this._setElementDisabledOrEnable(!1);var e=this;this._showPopBox(template.render("captchaTempl"),function(){var s=this.$el.find("#captchaImg"),t=this.$el.find("#captchaTips"),i=this.$el.find("#captchaInput");e.isNeedCaptcha=!0,sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_captcha_dialog_show"]),s.addClass("ms-none"),t.text("获取中...").removeClass("ms-none"),e.getCaptcha(e.loginOptions.account,{success:function(s){t.text("").addClass("ms-none"),i.val(""),e._showCaptchaImg(s.img)},error:function(){t.text("获取失败")}})})},_hideCaptchaPopup:function(){this.isNeedCaptcha=!1,this._hidePopBox(),this.$el.find("#captchaImg").addClass("ms-none"),this.$el.find("#captchaInput").val(""),this.$el.find("#captchaTips").addClass("ms-none")},refreshCaptcha:function(){if(!this.isGettingCaptcha){var e=this,s=this.$el.find("#captchaImg"),t=this.$el.find("#captchaTips"),i=this.$el.find("#captchaInput");s.addClass("ms-none"),t.text("获取中...").removeClass("ms-none"),sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_captcha_refresh"]),this.getCaptcha(this.loginOptions.account,{success:function(s){t.text("").addClass("ms-none"),i.val(""),e._showCaptchaImg(s.img),sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_captcha_refresh_success"])},error:function(){t.text("获取失败")}})}},getCaptcha:function(e,s){var t=this;this.isGettingCaptcha=!0,this.controller.getLoginCaptcha(e,{success:function(e){_.isUndefined(e.img)||_.isEmpty(e.img)?s.error&&s.error(resp):s.success&&s.success(e),setTimeout(function(){t.isGettingCaptcha=!1},0)},error:function(e){s.error&&s.error(e),setTimeout(function(){t.isGettingCaptcha=!1},0)}})},_showCaptchaImg:function(e,s){(_.isUndefined(s)||_.isEmpty(s))&&(s="jpeg"),_.isUndefined(e)||_.isEmpty(e)||this.$el.find("#captchaImg").attr("src","data:image/"+s+";base64,"+e).removeClass("ms-none")},_setElementDisabledOrEnable:function(e){e===!0?(this.$body.removeClass("btnClick-none"),this.$el.find("#username").removeAttr("disabled").removeClass("gr-vshid"),this.$el.find("#password").removeAttr("disabled").removeClass("ms-ni"),this.$el.find("#loginHistory").removeAttr("disabled")):(this.$body.addClass("btnClick-none"),this.$el.find("#username").attr("disabled","disabled"),this.$el.find("#password").attr("disabled","disabled"),this.$el.find("#loginHistory").attr("disabled","disabled"))},_autoResizeMask:function(e){function s(){var e=parseInt($(window).height()),s=parseInt($(document).height());return e>s?e:s}var t=this.$el.find("#"+e);t.height(s()),$(window).on("resize",function(){t.height(s())})},displayContentByChannel:function(){this.$el.find("#loginTabLogo").attr("src",this.channelSetting.loginLogo).removeClass("ms-ni"),S.global.otherChannel?(this.$el.find("#username").attr("placeholder",this.channelSetting.accountName),this.$el.find("#agreementBtn").html("注册即遵守《"+this.channelSetting.name+"服务条款》"),this.$el.find("#regSuccTitle").html("成功注册"+this.channelSetting.accountName),this.$el.find("#regSucPopAccountLb").html(this.channelSetting.accountName+":"),this.$el.find("#agreementBtn").html(this.channelSetting.name+"服务条款"),this.$el.find("#updatePassBoxAcLb").html(this.channelSetting.accountName),this.$el.find("#registerNowPopbox").find("#agreementBtn").html(this.channelSetting.name+"服务条款")):this.$el.find("#username").attr("placeholder",this.channelSetting.accountName+"\\手机")},_isLoginStateInvalid:function(e,s){var t=!1;if(!_.isUndefined(s)&&-1==this.checkedLastLoginTimeAccounts.indexOf(e)){var i=new Date,o=Date.parse(i)+i.getMilliseconds();o-s>=7776e6&&(t=!0,this._setAccountCheckedLastLoginTime(e,!0))}return t},_passwordValueChange:function(){var e=this.$el.find("#username").val();this._setAccountCheckedLastLoginTime(e,!0)},_setAccountCheckedLastLoginTime:function(e,s){_.isUndefined(e)||(s===!0&&-1==this.checkedLastLoginTimeAccounts.indexOf(e)?this.checkedLastLoginTimeAccounts+=e+"_":s===!1&&-1!=this.checkedLastLoginTimeAccounts.indexOf(e)&&(this.checkedLastLoginTimeAccounts=this.checkedLastLoginTimeAccounts.replace(e+"_","")))}});S.SSVW.SsoLn=Backbone.View.extend({el:"#userContainer",events:{"onclick #usernameLn,#passwordLn":"_flushInpt","onclick #regAccountLn,#regPasswordLn":"_flushInpt","onclick #loginButLn":"loginSubmit","onclick #registerButLn":"gotoRegister","onclick #finishRegBtnLn":"registerSubmit","onclick #forgetPassBtnLn":"forgetPassword","onclick #iconCheckboxLn":"setAccAutoLogin","onclick #regAgreeLn":"gotoAgreement","change #loginHistoryLn":"selectHis","onclick #regShowPassAreaLn":"setRegShowPassword","onclick #RegBackLn":"goBack"},loginHist:[],localConfig:{SECURITY_TYPE:{UNSECURITY:0,SECURITY:1}},loadingEl:{},initialize:function(){_.bindAll(this),this.controller=S.SSCT.GetHandler("Controller","SsoLn"),this.userController=S.SSCT.GetHandler("Controller","UserLn"),this.generalController=S.SSCT.GetHandler("Controller","General"),this.accountType=this.controller.CONFIG.ACCOUNT_TYPE.LOGIN;var s=S.global.versionCompare(S.global.version,rConfig.VERSIONS.SECURITY_VERSION);s!==!1&&s>=0?$("body").data("ctrl","true"):$("body").data("ctrl","")},login:function(s){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["sso"],!0);var e=s,o=sdk.PageCache.get("auto_login_info");sdk.PageCache.del("auto_login_info"),this.accountType=this.controller.CONFIG.ACCOUNT_TYPE.LOGIN,this.controller.clearHistFlag();var n=this.controller.getLoginConfig(),t=n.isAutoLogin;this._versionFixing(),t===!1?$("#iconCheckboxLn").addClass("current-ln"):$("#iconCheckboxLn").removeClass("current-ln"),o&&o.success&&o.data?this._setHistory(o.data.account,o.data.password,o.data.securityType):e?this._setHistory(e):this._setHistory(),-1!=navigator.userAgent.indexOf("Android 2.")&&this.$el.find("#passwordLn").css({height:"40px",top:"4px"})},loginSubmit:function(s){$(s.target).addClass("btnClick-none"),sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_login_b"]);var e=this,o=this.$el.find("#usernameLn"),n=this.$el.find("#passwordLn"),t="您正在登录联想账号",i=this.accountType,r=o.val(),a=n.getInp(),c=!this.$el.find("#iconCheckboxLn").hasClass("current-ln"),l=n.isModify(),d=l?this.localConfig.SECURITY_TYPE.UNSECURITY:this.localConfig.SECURITY_TYPE.SECURITY,g=S.global.versionCompare(S.global.version,rConfig.VERSIONS.SECURITY_VERSION),u=!1;g!==!1&&g>=0&&d===this.localConfig.SECURITY_TYPE.SECURITY&&(u=!0),this.controller.validLoginData(r,a,i,{isSecurity:u},this.controller.callBackMix(function(s,o){e.loadingEl=e._showLoading(t),e.controller.loginSubmit({account:s,password:o,accountType:i,rememberPassword:!0,isAutoLogin:c,securityType:d},!0,e.controller.callBackMix(function(s,o){s.get("ucid"),ucf.Cache.set("openTestGame_"+s.get("ucid"),s.get("openTestGame"),86400,!0),ucf.Cache.set("isAlpha_"+s.get("ucid"),s.get("isAlpha"),86400,!0),e.doLoginSuccess(s,o)},function(s,o){e._hideLoading(e.loadingEl),e._showErrorMsg(o.msg)}))},function(s){(105==s.code||102==s.code)&&(n.setInp(""),o.val()),e._showErrorMsg(s.msg)}))},doLoginSuccess:function(s){s.get("accountType"),that=this,curUser={},this.userController.getCurUserInfo(this.userController.callBackMix(function(s){curUser=s},function(){that.userController.sdkExit()})),that._hideLoading(that.loadingEl);var e=this.userController.getCurUser().ucid,o=ucf.Cache.get("openTestGame_"+e,!0),n=parseInt(ucf.Cache.get("isAlpha_"+e,!0));o&&o.status&&"B"==o.status?sdk.Url.redirect("../game/game.html#!game/notOpen/"+encodeURIComponent(o.message)):n?sdk.Url.redirect("../game/game.html#!game/validCode/false"):that.userController.sdkExit()},gotoRegister:function(s){$(s.target).addClass("btnClick-none"),sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_sign_b"]),S.SCEV.Proxy.trigger(S.SCEV.EventType.PRE_ROUTE,{enterPage:sdk.Log.businesses.PAGE_USER,enterBusiness:["register"]}),S.Url.location.route("#!sso/register")},register:function(){if(-1!=navigator.userAgent.indexOf("Android 2.")){var s=this.$el.find("#regPasswordLn");s.css({height:"40px",top:"4px"})}},registerSubmit:function(){var s=this,e=this.$el.find("#regAccountLn").val(),o=this.$el.find("#regPasswordLn").val();this.controller.validRegisterData(e,o,this.controller.callBackMix(function(e){s.loadingEl=s._showLoading(),s.userController.register({name:e,password:o,isRandomPassword:!1,agree:!0},s.userController.callBackMix(function(n){s.generalController.setCacheData("user_info_"+n.get("ucid"),{random:!1,password:o},0,!0);var t={account:e,isAutoLogin:!0,password:o};s.controller.loginSubmit(t,!0,s.controller.callBackMix(function(e,o){e.get("ucid"),ucf.Cache.set("openTestGame_"+e.get("ucid"),e.get("openTestGame"),86400,!0),ucf.Cache.set("isAlpha_"+e.get("ucid"),e.get("isAlpha"),86400,!0),s.doLoginSuccess(e,o)},function(e,o){s._hideLoading(s.loadingEl),s._showErrorMsg(o.msg||"注册成功，登录失败")}))},function(e){s._hideLoading(s.loadingEl),s.generalController.sendClientMsg(e)}),!0)},function(e){s._showErrorMsg(e.msg)}))},setAccAutoLogin:function(){var s=this.$el.find("#iconCheckboxLn");s.hasClass("current-ln")?(s.removeClass("current-ln"),sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_OpenAutoLogin_b","login"])):(s.addClass("current-ln"),sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_CloseAutoLogin_b","login"]))},setRegShowPassword:function(){var s=this.$el.find("#regShowPassLn"),e=this.$el.find("#regPasswordLn");s.hasClass("current-ln")?(s.removeClass("current-ln"),e.attr("type","text")):(s.addClass("current-ln"),e.attr("type","password"))},_versionFixing:function(){var s=S.global.versionCompare(S.global.version,rConfig.VERSIONS.AUTO_LOGIN_VERSION);s!==!1&&s>=0?$("#checkboxAreaLn").removeClass("ms-ni"):$("#checkboxAreaLn").addClass("ms-ni")},_setUsername:function(s){this.$el.find("#usernameLn").val(s)},_setPassword:function(s,e){this.$el.find("#passwordLn").setInp(s).setModify(e)},selectHis:function(){var s=document.querySelector("#loginHistoryLn"),e=s.options[s.selectedIndex],o=e.value,n=o||this.$el.find("#loginHistoryLn").val();if("-1"!=n){var t={};this.controller.getHistByUsername(n,this.accountType,this.controller.callBackMix(function(s){t=s})),this._setAccount({account:t.account,password:t.password,isRandomPassword:t.isRandomPassword})}},_resetUsername:function(){this._setUsername(""),this._resetPassword()},_resetPassword:function(){this._setPassword("")},forgetPassword:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_forgetpw_l"]),this.generalController.loadUrl(S.global.channelSetting.forgetPasswordLink,!0,!1,null)},gotoAgreement:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_article_l"]),this.generalController.loadUrl(S.global.channelSetting.agreementLink,!0,!1,null)},goBack:function(){history.back()},_setHistory:function(s,e,o){var n=this,t={isRandomPassword:!1,account:"",password:""};this._getHistData(_.bind(function(i){n.loginHist=i;var r=this.controller.getHistLength(this.accountType);if(0===r||_.isUndefined(i[0]))this.$el.find("#showHistoryLn").hide();else{r>1?this.$el.find("#showHistoryLn").show():this.$el.find("#showHistoryLn").hide();var a=null,c=document.createDocumentFragment(),l=new Option("请选择账号","-1");c.appendChild(l),_.each(i,function(e){_.isEmpty(s)||e.account!==s||(a=e),e.account=n.controller.removeFirmSuffix(e.account),c.appendChild(new Option(e.account,e.account))}),this.$el.find("#loginHistoryLn").append(c),s&&e?a={isRandomPassword:!1,account:s,rememberPassword:!0,password:e}:s&&null===a?a={isRandomPassword:!1,account:s,rememberPassword:!1,password:""}:null===a&&(a=i[0]),t.isRandomPassword=a.isRandomPassword,t.account=a.account,a.rememberPassword&&(t.password=a.password)}this._setAccount({account:t.account,password:t.password,isRandomPassword:t.isRandomPassword,securityType:o})},this),!0)},_flushInpt:function(s){_.isEmpty($(s.target).val())&&$(s.target).val("")},_setAccount:function(s){var e;this._setUsername(s.account),1==s.securityType?e=!1:0==s.securityType&&(e=!0),this._setPassword(s.password,e)},_showLoading:function(s){var e=S.common.ui.NoticeBox.loading(s);return e},_hideLoading:function(s){S.common.ui.NoticeBox.hide(s,null,"remove")},_getHistData:function(s,e){var o=this,n=this.controller.getHistories(this.accountType);_.isUndefined(n)||e===!0?this.controller.getHistory(this.accountType,this.controller.callBackMix(function(e){s&&s(e)},function(s){o._showErrorMsg(s)})):s&&s(n)},_showErrorMsg:function(s){this.generalController.sendClientMsg(s)}});S.SSVW.User=Backbone.View.extend({el:"#userContainer",events:{"onclick #oldPass,#newPass,#regGuestPassword,#passwordToBind":"flushInpt","onclick #changePassBtn":"gotoUpdatePass","onclick #confirmChangePass":"doUpdatePass","onclick #payHistoryBtn":"gotoPayHistory","onclick #logoutBtn":"logout","onclick #feedBackBtn":"gotoFeedBack","onclick #existAccountBtn":"gotoLogin","onclick #toSecrecyBtn":"gotoSecrecy","onclick #changeNickname":"changeNickname","onclick #submitNicknameBtn":"submitNickname","onclick #accountSecureBtn":"gotoAccountSecure","onclick #gotoSecCenterBtn":"gotoSecCenter","onclick #rechargeBtn":"gotoRecharge","onclick #multiAccountBtn":"gotoMultiAccount","onclick .del_icon":"_deleteHistory","onclick #exitBtn":"curLogout","onclick #activeAgreementBtn":"gotoAgreement","onclick #bindUCAccount":"gotoActivate","onclick #bindUCAccountPlf":"gotoActivatePlf","onclick #regGuest":"registerGuestAccount","onclick #activateGuest":"bindGuestAccount","onclick #bindReturn":"bindReturn","change  #bindLoginHistory":"selectHis","onclick #bindLoginHistory":"logHist","onclick #userBaseInfo":"hideEditNickname","onclick #autoLoginSwitch":"setAutoLoginStatus","onclick .switAcc":"switAccHandler"},pageScroll:{},redirectTitle:void 0,redirectUrl:void 0,_enableUserChange:!1,config:{SECURITY_TYPE:{UNSECURITY:0,SECURITY:1}},initialize:function(){_.bindAll(this),this.controller=S.SSCT.GetHandler("Controller","User"),this.ssoController=S.SSCT.GetHandler("Controller","Sso"),this.generalController=S.SSCT.GetHandler("Controller","General"),this.$body=$("body");var e=S.global.versionCompare(S.global.version,rConfig.VERSIONS.SECURITY_VERSION);e!==!1&&e>=0?this.$body.data("ctrl","true"):this.$body.data("ctrl","")},userInfo:function(){S.SCEV.Proxy.trigger(S.SCEV.EventType.PRE_ROUTE,{enterPage:sdk.Log.businesses.PAGE_USER,enterBusiness:["management"]}),this._userInfo(),S.global.otherChannel?(this.entranceControl4Jc(),this.controller.getBaseUserInfo(this.controller.callBackMix(this.renderBaseInfo4Jc,$.proxy(function(e){this.renderBaseInfo4Jc({}),sdk.common.ui.NoticeBox.error(e)},this)))):(this.entranceControl(),this.controller.getBaseUserInfo(this.controller.callBackMix(this.renderBaseInfo,$.proxy(function(e){this.renderBaseInfo({}),sdk.common.ui.NoticeBox.error(e)},this))))},updatePassword:function(){S.SCEV.Proxy.trigger(S.SCEV.EventType.PRE_ROUTE,{enterPage:sdk.Log.businesses.PAGE_USER,enterBusiness:["updatePassword"]}),this._userInfo();var e=this.controller.getCurUser();this.controller.userName;var t=this.$el.find("#newPass");this.$el.find("#up-nickname").html(""),this.$el.find("#up-ucid").html(e.ucid),t.val(""),t.attr("placeholder","请输入6-20位字母或数字");var n=this.generalController.getCacheData("user_info_"+e.ucid,!0);_.isUndefined(n)||_.isEmpty(n)||!n.random||(e.isRandomPassword=!0,e.randomPassword=n.password);var o=this.$el.find("#oldPass"),i=this;e.isRandomPassword?(o.attr("placeholder",""),o.val(e.randomPassword)):(o.val(""),o.attr("placeholder","请输入6-20位字母或数字")),S.SCEV.Proxy.trigger(S.SCEV.EventType.SDK_REMOVE_WIN_EVENT,{eventName:"bridgeTopBtnClicked"}),S.SCEV.Proxy.trigger(S.SCEV.EventType.SDK_WINDOW_EVENT,{eventName:"bridgeTopBtnClicked",handler:function(e){"onEdit"==e.action&&i.editMode===!0?i.cancelEditMode():"doUpdatePass"==e.action&&i.editMode!==!0&&i.doUpdatePass()}})},renderBaseInfo:function(e){var t=this,n=S.SSCT.GetHandler("Controller","AccountManage"),o=this.$el.find("#secureState");o.removeClass("red");var i=!0;sdk.PageCache.del("risk");var s=this.controller.getCurUser();_.isUndefined(s)||_.isUndefined(s.accountType)||s.accountType!=rConfig.ACCOUNT_TYPE.QQ||(i=!1),i&&(this.$el.find("#usrCtrlSafe").removeClass("ms-ni"),n.getSecureStateDetail(["mobile","question"],n.callBackMix(function(e){_.isUndefined(e.mobile)&&_.isUndefined(e.question)||1!==e.mobile.code||1!==e.question.code&&126!==e.question.code?(o.text("获取失败"),sdk.PageCache.set("risk","fail")):_.isEmpty(e.mobile.mobile)&&_.isEmpty(e.question.password_question)?(o.text("未设置"),o.addClass("red"),sdk.PageCache.set("risk","none")):_.isEmpty(e.mobile.mobile)||_.isEmpty(e.question.password_question)?_.isEmpty(e.question.password_question)?_.isEmpty(e.mobile.mobile)||(o.text("手机"),sdk.PageCache.set("risk","mobile"),sdk.PageCache.set("secrecy_binding_mobile",e.mobile.mobile)):(o.text("密保问题"),sdk.PageCache.set("risk","question")):(o.text("手机、密保问题"),sdk.PageCache.set("risk","both"),sdk.PageCache.set("secrecy_binding_mobile",e.mobile.mobile))},function(){o.text("获取失败"),sdk.PageCache.set("risk","fail")})));var r=S.SSCT.GetHandler("Controller","Pay");r.getUPointBalance(r.callBackMix(function(e){t.$el.find("#uPointBalance").text("余额："+e.get("balance")+" U点")},function(e){t._showErrorMsg(e)})),this._isShowMultiAccount()&&this._getHistData(function(){$accountNo=t.$el.find("#accountNo"),$accountNo.addClass("pag_blue");var e=t.ssoController.histLength[rConfig.ACCOUNT_TYPE.UC];e>99?$accountNo.text("N"):$accountNo.text(e)},!0);var a=S.global.versionCompare(S.global.version,rConfig.VERSIONS.AUTO_LOGIN_VERSION);a!==!1&&a>=0?(this.$el.find("#autoLoginSetting").removeClass("ms-ni"),this.$el.find("#autoLoginNoti").removeClass("ms-ni")):(this.$el.find("#autoLoginSetting").addClass("ms-ni"),this.$el.find("#autoLoginNoti").addClass("ms-ni")),this.$el.find("#userInfoDetailBtn").removeAttr("disabled"),this.controller.getCurUserInfo();var c,l=this.controller.getCurUser(),d=e.userName;if(_.isUndefined(d)||_.isEmpty(d)?d="UC用户":d.length>rConfig.user.showUserNickLen&&(d=d.substr(0,rConfig.user.showUserNickLen-1)+"..."),c=_.isUndefined(e.level)?0:e.level,this.$el.find("#sdkVersion").html(eConfig.version),_.isEmpty(e))ucf.Cache.set("userBaseInfo_"+l.ucid,{level:0,userName:"UC用户"},1800,!0),this.$el.find("#userInfoNickname").html(d),this.$el.find("#userInfoUcid").html(l.ucid),this.$el.find("#userInfoAvatar").attr("src","../common/sdk_images/tx-999.jpg");else{this.$el.find("#userInfoNickname").html(d),this.$el.find("#userInfoUcid").html(l.ucid);var u=!1,g="";0===e.gender?(g="../common/sdk_images/czsex.png",genderAvatar="../common/sdk_images/tx-998.jpg"):1===e.gender?(g="../common/sdk_images/sexn.png",genderAvatar="../common/sdk_images/tx-999.jpg"):(genderAvatar="../common/sdk_images/tx-999.jpg",u=!0),this.$el.find("#userInfoAvatar").attr("src",genderAvatar)}this.controller.getFeatureSwitch(this.controller.callBackMix(function(e){t._enableUserChange=_.isBoolean(e.enableUserChange)?e.enableUserChange:t._enableUserChange,e.enableUserChange&&t.$el.find("#exitBtn").removeClass("ms-ni")})),this.generalController.getClientConfig(this.generalController.callBackMix(function(e){_.isUndefined(e)||_.isUndefined(e.isShowVip)||1!=e.isShowVip?t.$el.find("#becomeVipBtn").remove():(t.$el.find("#userInfoVipArea").removeClass("ms-none"),t.$el.find("#becomeVipBtn").removeClass("ms-ni"),t.controller.getVipInfo({success:function(e){_.isUndefined(e)||_.isUndefined(e.status)||1!=e.status?(t.$el.find("#vipImgGray").removeClass("ms-none"),t.$el.find("#lightVip").removeClass("ms-none"),t.$el.find("#vipSpace").hide()):t.$el.find("#vipImgDefault").removeClass("ms-none")},error:function(){t.$el.find("#vipImgGray").removeClass("ms-none"),t.$el.find("#lightVip").removeClass("ms-none"),t.$el.find("#vipSpace").hide()}}))},function(){}))},renderBaseInfo4Jc:function(){var e=this,t=this.controller.getCurUser(),n=_.isUndefined(t.account)?"":t.account;this.$el.find("#myAccountLn").text(n),this._isShowMultiAccount()&&this._getHistData(function(){$accountNo=e.$el.find("#accountNo"),$accountNo.addClass("pag_blue");var t=e.ssoController.histLength[rConfig.ACCOUNT_TYPE.UC];t>99?$accountNo.text("N"):$accountNo.text(t)},!0);var o=S.global.versionCompare(S.global.version,rConfig.VERSIONS.AUTO_LOGIN_VERSION);o!==!1&&o>=0?(this.$el.find("#autoLoginSetting").removeClass("ms-ni"),this.$el.find("#autoLoginNoti").removeClass("ms-ni")):(this.$el.find("#autoLoginSetting").addClass("ms-ni"),this.$el.find("#autoLoginNoti").addClass("ms-ni")),this.$el.find("#sdkVersion").html(eConfig.version),this.controller.getFeatureSwitch(this.controller.callBackMix(function(t){e._enableUserChange=_.isBoolean(t.enableUserChange)?t.enableUserChange:e._enableUserChange,t.enableUserChange&&e.$el.find("#exitBtn").removeClass("ms-ni")}))},entranceControl:function(){var e=!1,t=this;this.controller.getFeatureSwitch(this.controller.callBackMix(function(n){var o=t.$el.find("#payHistoryBtn");if(n.enablePayHistory)o.removeClass("ms-ni").addClass("p-last-border"),e=!0;else{var i=t.$el.find("#rechargeBtn");i.length>0&&(i[0].style.webkitBorderRadius="5px"),o.addClass("ms-ni")}if(n.enableUserChange){var s=t.$el.find("#logoutBtn");s.parent().removeClass("ms-none"),e||s.parent().addClass("p-last-border")}var r=t.$el.find("#autoLoginSwitch"),a=t.$el.find("#autoLoginNoti");n.isAutoLogin?(r.addClass("on"),a.html("关闭后每次进入游戏时可重新选择账号进行登录。")):(r.removeClass("on"),a.html("开启后将自动使用最近登录的账号进入游戏。"))},function(){}))},entranceControl4Jc:function(){var e=this;this.$el.find("#bbsBtn").bind("click",function(){window.location.href=S.global.channelSetting.bbsLink}),this.controller.getFeatureSwitch(this.controller.callBackMix(function(t){if(t.enableUserChange){var n=e.$el.find("#logoutBtn");n.parent().removeClass("ms-none"),n.parent().addClass("p-last-border")}var o=e.$el.find("#autoLoginSwitch"),i=e.$el.find("#autoLoginNoti");t.isAutoLogin?(o.addClass("on"),i.html("关闭后每次进入游戏时可重新选择账号进行登录。")):(o.removeClass("on"),i.html("开启后将自动使用最近登录的账号进入游戏。"))},function(){}))},doUpdatePass:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_ModifyPW_sumit_b"]);var e=this.$el.find("#oldPass").val(),t=this.$el.find("#newPass").val();if(!e)return this._showErrorMsg("请输入旧密码"),void 0;if(!t)return this._showErrorMsg("请输入新密码"),void 0;this.controller.setCurUser({}),this.$el.find("#confirmChangePass").attr("disabled","disabled");var n={oldPassword:e,password:t,isPostPass:!0},o=this;this.controller.updatePass(n,this.controller.callBackMix(function(){o.controller.getCurUserInfo(o.controller.callBackMix(function(){o.$body.addClass("btnClick-none"),o._showErrorMsg("更新密码成功"),S.Url.back()},function(){S.Url.location.route("#!sso/login")}))},function(e){o._showErrorMsg(e),o.$el.find("#confirmChangePass").removeAttr("disabled")}))},flushInpt:function(e){_.isEmpty($(e.target).val())&&$(e.target).val(""),_.isUndefined(this.noticeBar)||_.isEmpty(this.noticeBar)||sdk.common.ui.NoticeBox.hide(this.noticeBar,null,"slide")},logout:function(){this.generalController.jumpToNativePage({uiBusiness:"login"})},_userInfo:function(){var e=this;this.controller.getCurUserInfo(this.controller.callBackMix(function(t){var n=S.global.versionCompare(S.global.version,rConfig.VERSIONS.SECURITY_VERSION);n!==!1&&n>=0&&(_.isUndefined(t.isRandomPassword)||0!=t.isRandomPassword||_.isUndefined(t.account)||e.generalController.setCacheData("user_info_"+t.account,{random:!1},0,!0))},$.proxy(function(){this.generalController.getSourcePageInfo(this.generalController.callBackMix(function(t){e.generalController.jumpToNativePage(t)},function(){S.Url.location.route("#!sso/login")}))},this)))},gotoUpdatePass:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_account_ModifyPW_l"]),S.Url.location.route("#!user/updatePassword")},gotoPayHistory:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_account_PayRecord_l"]);var e=window.location.href.match("user/user.html")?"user/user.html#!user":"user/user_landscape.html#!user",t=window.location.href.replace(e,"pay/pay.html#!pay/history/"+S.SSCT.GetHandler("Controller","User").getCurUser().gameName);sdk.Log.pageEnter(sdk.Log.businesses.PAGE_PAY,["payHistory"]),S.Url.redirect(eConfig.payHistoryUrl+(eConfig.payHistoryUrl.indexOf("?")>=0?"&":"?")+"p="+encodeURIComponent(t))},gotoLogin:function(){var e=this;this.generalController.getSourcePageInfo(this.generalController.callBackMix(function(t){e.generalController.jumpToNativePage(t)},function(){S.Url.location.route("#!sso")}))},gotoFeedBack:function(){sdk.Log.pageEnter(sdk.Log.businesses.PAGE_USER,["feedBack"]),sdk.PageCache.set("feedBack_result_url",window.location.href);var e=S.SSCT.GetHandler("Controller","Game"),t=this;e.getGameInfo(e.callBackMix(function(e){S.Url.redirect(eConfig.feedBackCenter+"?uid="+t.controller.getCurUser().ucid+"&uname="+t.controller.getCurUser().nickname+"&gid="+e.gameId+"&gname="+t.controller.getCurUser().gameName+"&skey=D02")}))},gotoSecrecy:function(){S.Url.location.route("#!secrecy/preBind/usercenter")},multiAccount:function(){var e="",t=this.controller.getCurUser(),n=this,o="";this.editMode=!1,this._getHistData(function(i){_.each(i,function(n){o=n.account.toString(),itemHtml=template("accountInfoItemTempl",{gameName:_.isEmpty(n.gameName)?"空":n.gameName,ucAccount:o,dispAccount:o.replace("@",'<span class="at at-s12"></span>'),status:o==t.account?"icon_st":"",accountName:S.global.channelSetting.name}),e+=itemHtml}),n.$body.addClass("btnClick-none"),n.$el.addClass("btnClick-none");var s=$("#accountInfos");s.addClass("btnClick-none"),n.$el.find("#accountInfos").html(e),S.SCEV.Proxy.trigger(S.SCEV.EventType.SDK_REMOVE_WIN_EVENT,{eventName:"bridgeTopBtnClicked"}),S.SCEV.Proxy.trigger(S.SCEV.EventType.SDK_WINDOW_EVENT,{eventName:"bridgeTopBtnClicked",handler:function(e){"backToUser"==e.action&&(sdk.common.ui.MsgBox.remove(),S.Url.back()),"onEdit"==e.action&&n.editMode===!0?n.cancelEditMode():"onEdit"==e.action&&n.editMode!==!0&&n.showEditMode()}})},!0),this.controller.getFeatureSwitch(this.controller.callBackMix(function(e){var t=S.global.versionCompare(S.global.version,rConfig.VERSIONS.AUTO_LOGIN_VERSION);if(e.enableUserChange&&t!==!1&&t>=0){for(var o=document.querySelectorAll(".gotoStatus"),i=0;i<o.length;i++)o[i].style.visibility="visible";n._enableGotoStatus=!0}}))},showEditMode:function(){this.editMode=!0,this.generalController.setHeaderStyle({topBarBtnBackGame:{text:"完成",visible:!0,visiblePersist:!1,btnShape:"rect"}});for(var e=document.querySelectorAll(".delStatus"),t=0;t<e.length;t++)e[t].style.display="block";if(this._enableGotoStatus===!0)for(var n=document.querySelectorAll(".gotoStatus"),t=0;t<n.length;t++)n[t].style.visibility="hidden"},cancelEditMode:function(){this.editMode=!1,this.generalController.setHeaderStyle({topBarBtnBackGame:{text:"编辑",visible:!0,visiblePersist:!1,btnShape:"rect"}});for(var e=document.querySelectorAll(".delStatus"),t=0;t<e.length;t++)e[t].style.display="none";if(this._enableGotoStatus===!0)for(var n=document.querySelectorAll(".gotoStatus"),t=0;t<n.length;t++)n[t].style.visibility="visible"},_getHistData:function(e,t){var n=this,o=rConfig.ACCOUNT_TYPE.UC,i=this.ssoController.getHistories(o);!i||t?this.ssoController.getHistory(o,this.controller.callBackMix(function(t){e&&e(t)},function(e){n._showErrorMsg(e)})):e&&e(i)},removeHistory:function(e){var t=e,n=$(t),o=n.attr("data-account"),i=rConfig.ACCOUNT_TYPE.UC,s=this;this.controller.removeHistory({accountType:i,account:parseInt(o)},this.controller.callBackMix(function(){n.hide(),n.remove(),ucf.Cache.remove("user_info_"+o,!0)},function(){s._showErrorMsg()}))},_deleteHistory:function(e){var t=this,n=$(e.target);if(e.stopPropagation(),n.hasClass("del_icon")){$(e.target).addClass("btnClick-none");var o=e.target.parentNode.parentNode;this._confirm({title:'<div><center><p class="gr-f16">确认在本机删除账号'+$(o).attr("data-account")+"？</p></center></div><div><center><p>被删除账号将不会出现在登录输入框中</p></center></div>",confirm:"确定",cancel:"取消"},function(){$(e.target).removeClass("btnClick-none"),t.removeHistory(o)},function(){$(e.target).removeClass("btnClick-none")})}},curLogout:function(){var e=this;sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_Account_Logout_b"]),sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_Account_Logout_w"]),this._confirm({title:'<div><center><p class="gr-f16">确定要退出当前账号？</p></center></div>',confirm:"退出账号",cancel:"取消"},function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_Account_LogoutOK_b"]),S.sdkBase.request(S.sdkBase.servType.LOGIN,S.sdkBase.actions.LOGOUT),e.controller.notifyCp({code:1,msg:""},{success:function(){e.controller.sdkExit()},error:function(){e._showErrorMsg("通知游戏失败")}},"logout"),sdk.PageCache.set("clear_history",1)},function(){})},_showErrorMsg:function(e){this.generalController.sendClientMsg(e)},changeNickname:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_account_NicknameModify_b"]),this.$el.find("#userInfoNickname").toggleClass("hide"),this.$el.find("#changeNickname").toggleClass("hide"),this.$el.find("#editNickname").toggleClass("hide"),this.$el.find("#submitNicknameBtn").toggleClass("hide"),this.$el.find("#editNickname").val("")},hideEditNickname:function(e){"editNickname"!=e.target.id&&"changeNickname"!=e.target.id&&this.$el.find("#userInfoNickname").hasClass("hide")&&this.changeNickname()},submitNickname:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_account_NicknameModifyOK_b"]);var e=this.$el.find("#editNickname").val();if(!e)return this._showErrorMsg("请输入昵称"),void 0;this.controller.setCurUser({});var t={uid:this.$el.find("#userInfoUcid").text(),userName:e},n=this;this.controller.updateNickname(t,this.controller.callBackMix(function(){n.controller.getCurUserInfo(n.controller.callBackMix(function(){n._showErrorMsg("修改昵称成功"),e.length>rConfig.user.showUserNickLen&&(e=e.substr(0,rConfig.user.showUserNickLen-1)+"..."),n.$el.find("#userInfoNickname").text(e)},function(){S.Url.location.route("#!sso/login")}))},function(e){"userName_isExist"==e?n._showErrorMsg("用户名已存在"):n._showErrorMsg(e)}))},gotoAccountSecure:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_account_AccountSafe_l"]),S.SCEV.Proxy.trigger(S.SCEV.EventType.SDK_REMOVE_WIN_EVENT,{eventName:"bridgeTopBtnClicked"}),S.SCEV.Proxy.trigger(S.SCEV.EventType.SDK_WINDOW_EVENT,{eventName:"bridgeTopBtnClicked",handler:function(e){"backToUser"==e.action&&(sdk.common.ui.MsgBox.remove(),S.Url.back())}}),this.$el.find("#secureState"),sdk.Log.pageEnter(sdk.Log.businesses.PAGE_USER,["accountSecure"]),S.Url.location.route("#!secrecy/preBind/usercenter")},gotoSecCenter:function(){sdk.Log.pageEnter(sdk.Log.businesses.PAGE_USER,["accountSecure"]),sdk.Log.pageClose(sdk.Log.businesses.PAGE_USER,["accountSecure"]),sdk.PageCache.set("sdk_redirect_out",1);var e=eConfig.secureUrl+"?uc_param_str=frpfvesscpmilaprnisieiut&appId=17"+"&backUrl="+encodeURIComponent(eConfig.sdkExitBackUrl);S.Url.redirect(e)},gotoRecharge:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_account_PayUpoint_l"]),sdk.Log.pageEnter(sdk.Log.businesses.PAGE_USER,["udPay"]),sdk.Log.pageClose(sdk.Log.businesses.PAGE_USER,["udPay"]),sdk.PageCache.set("sdk_redirect_out",1);var e={},t=this,n=S.sdkBase.request(S.sdkBase.servType.COMMON,S.sdkBase.actions.GET_GAME_INFO);n&&n.success&&(e.gameId=n.data.gameId,e.serverId=n.data.serverId,e.upayPage=rConfig.apis.U_PAY_PAGE,this.controller.rechargeUPoint(e,{success:function(e){S.Url.redirect(e.url)},error:function(e){t._showErrorMsg(e.msg)}}))},gotoMultiAccount:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_account_AccountManage_l"]),sdk.Log.pageEnter(sdk.Log.businesses.PAGE_USER,["multiAccount"]),S.Url.location.route("#!user/multiAccount")},gotoAgreement:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5a_article_l"]),S.Url.location.route("#!user/agreement")},gotoActivate:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5a_formaloldid_l"]),S.Url.location.route("#!user/activate")},gotoActivatePlf:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5a_formaloldid_l"]),S.Url.location.route("#!user/activatePlf")},activate:function(){sdk.Log.pageEnter(sdk.Log.businesses.PAGE_USER,["h5a_formaloldid_p"]),this._backButtonHandle(function(e){"activeBackGame"==e.action&&(sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5a_leaveformaloldid_b"]),S.SSCT.GetHandler("Controller","User").sdkExit())});var e,t,n=sdk.PageCache.get("auto_login_info"),o=S.SSCT.GetHandler("View","Sso"),i=S.SSCT.GetHandler("Controller","Sso"),s=this;n.data&&(e=n.data.account,t=n.data.password),o._getHistData(function(n){var o=i.getHistLength(0);if(0===o||_.isUndefined(n[0]))s.$el.find("#bindLoginHistory").removeClass("ms-block").addClass("ms-ni");else{o>1?s.$el.find("#bindLoginHistory").removeClass("ms-ni").addClass("ms-block"):s.$el.find("#bindLoginHistory").removeClass("ms-block").addClass("ms-ni");var r=document.createDocumentFragment(),a=new Option("请选择账号","-1");r.appendChild(a),_.each(n,function(e){r.appendChild(new Option(e.account,e.account))}),s.$el.find("#bindLoginHistory").append(r)}e&&t?(s.$el.find("#ucAccountToBind").val(e),s.$el.find("#passwordToBind").setInp(t)):n[0]&&(s.$el.find("#ucAccountToBind").setInp(n[0].account),s.$el.find("#passwordToBind").setInp(n[0].password))},!0)},activatePlf:function(){this.activate()},regActivate:function(){sdk.Log.pageEnter(sdk.Log.businesses.PAGE_USER,["h5a_formalsign_p"]),this._backButtonHandle(function(e){"regActiveBackGame"==e.action&&(sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5a_leaveformalsign_b"]),S.SSCT.GetHandler("Controller","User").sdkExit())})},regActivatePlf:function(){this.regActivate();var e=sdk.common.utils.Url.getQueryStringArgs();e.title&&(this.redirectTitle=e.title,this.redirectUrl=e.redirectUrl,this.$el.find("#activateHint").text("进入"+e.title+"前，请先注册账号并完成激活："))},logHist:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5a_otherid_b"])},selectHis:function(){var e=this.$el.find("#bindLoginHistory").val(),t=e||this.$el.find("#bindLoginHistory").val(),n=S.SSCT.GetHandler("Controller","Sso"),o=this;"-1"!=t&&n.getHistByUsername(t,0,this.controller.callBackMix(function(e){o.$el.find("#ucAccountToBind").val(e.account),o.$el.find("#passwordToBind").setInp(e.password)},function(){o.$el.find("#passwordToBind").setInp("")}))},registerGuestAccount:function(){function e(e){sdk.Log.click(sdk.Log.businesses.PAGE_USER,[e])}sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5a_formalsign_b"]),this.$el.find("#regGuest").addClass("btnClick-none");var t=this.$el.find("#regGuestEmail").val(),n=this.$el.find("#regGuestPassword").val(),o=(this.config.SECURITY_TYPE.UNSECURITY,this);if(t&&!t.match(rConfig.user.emailAccountFilter))return this._showErrorMsg("邮箱输入有误"),e("email_format_error"),void 0;if(n.length<6||n.length>20)return this._showErrorMsg("密码长度不符（6-20位）"),void 0;if(n.match(rConfig.user.passwordFilter))return this._showErrorMsg("密码必须为字母或数字"),void 0;var i={email:t,password:n,isRandomPassword:!1};this.controller.registerGuestAccount(i,this.controller.callBackMix(function(e){t.length>20&&(t=t.substr(0,19)+"..."),o.$el.find("#newUCID").text(e.data.ucid),o.$el.find("#bindEmail").text(t),t?o.$el.find("#bindEmailP").removeClass("ms-vshid"):o.$el.find("#bindEmailP").addClass("ms-vshid"),setTimeout($.proxy(function(){this.bindGuestAccountSuccess()},o),80)},function(t){t.msg.match("已被使用")&&e("email_is_used_error"),o._showErrorMsg(t.msg)}))},bindGuestAccountSuccess:function(){this._hideLinkEffect("bindReturn"),sdk.Log.pageEnter(sdk.Log.businesses.PAGE_USER,["h5a_formalsignok_p"]),this.redirectTitle&&this.$el.find("#bindReturn").val("进入"+this.redirectTitle);var e=this.$el.find("#registerGuestAccountSuccess");e.removeClass("ms-none")},bindGuestAccount:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5a_formaloldid_b"]);var e=this.$el.find("#ucAccountToBind").val(),t=this.$el.find("#passwordToBind").getInp(),n=this.$el.find("#passwordToBind").isModify(),o=n?this.config.SECURITY_TYPE.UNSECURITY:this.config.SECURITY_TYPE.SECURITY,i=this,s=S.global.versionCompare(S.global.version,rConfig.VERSIONS.SECURITY_VERSION);if(""==e)return this._showErrorMsg("请输入账号"),void 0;if(0===t.length)return this._showErrorMsg("密码不能为空"),void 0;if(s!==!1&&s>=0&&o===this.config.SECURITY_TYPE.SECURITY);else if(t.length<6||t.length>20)return this._showErrorMsg("密码长度不符（6-20位）"),!0;var r={account:e,password:t,accountType:0,rememberPassword:!0,isAutoLogin:!0,securityType:o},a=this._textLoading();this.controller.bindGuestAccount(r,this.controller.callBackMix(function(){i._hideLoading(a),i.redirectUrl?S.Url.redirect(i.redirectUrl):i.controller.sdkExit()},function(e){i._hideLoading(a),i._showErrorMsg(e.msg)}))},_textLoading:function(){var e=S.common.ui.NoticeBox.loading("loading_text");return e},_hideLoading:function(e){S.common.ui.NoticeBox.hide(e,null,"remove")},bindReturn:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5a_formalsignok_b"]),this.redirectUrl?S.Url.redirect(this.redirectUrl):this.controller.sdkExit()},_backButtonHandle:function(e){S.SCEV.Proxy.trigger(S.SCEV.EventType.SDK_REMOVE_WIN_EVENT,{eventName:"bridgeTopBtnClicked"}),S.SCEV.Proxy.trigger(S.SCEV.EventType.SDK_WINDOW_EVENT,{eventName:"bridgeTopBtnClicked",handler:e})},setAutoLoginStatus:function(){function e(){o.addClass("on"),i.$el.find("#autoLoginNoti").html("关闭后每次进入游戏时可重新选择账号进行登录。")}function t(){o.removeClass("on"),i.$el.find("#autoLoginNoti").html("开启后将自动使用最近登录的账号进入游戏。")}function n(e){e.msg&&_this._showErrorMsg(e.msg)}var o=this.$el.find("#autoLoginSwitch"),i=this;o.hasClass("on")?(sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_CloseAutoLogin_b","usercenter"]),this.controller.setAutoLoginState({isAutoLogin:!1},{success:t,error:n})):(sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_OpenAutoLogin_b","usercenter"]),this.controller.setAutoLoginState({isAutoLogin:!0},{success:e,error:n}))},_getAccParent:function(e){var t=e;return t=t.data("account")?t:t.parent(),t=t.data("account")?t:t.parent(),t=t.data("account")?t:t.parent()},switAccHandler:function(e){if(this.editMode!==!0&&this._enableUserChange&&this._enableGotoStatus){var t=$(e.target),n=this,o=this._getAccParent(t),i=t.parent().data("account")||t.parent().parent().data("account")||t.parent().parent().parent().data("account");!i||$(".icon_st",o).length>0||(sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_ChangeAccount_w"]),t.addClass("btnClick-none"),this._confirm({title:'<div><center><p class="gr-f16">您要切换账号'+i+"登录？</p></center></div>",confirm:"确认",cancel:"取消"},function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_ChangeAccountOK_b"]),S.sdkBase.request(S.sdkBase.servType.LOGIN,S.sdkBase.actions.LOGOUT),n.controller.notifyCp({code:1,msg:"",account:i},{success:function(){n.controller.sdkExit()},error:function(){n._showErrorMsg("通知游戏失败")}},"logout")}))}},_confirm:function(e,t,n){var o=this;this.$body.addClass("btnClick-none"),sdk.common.ui.MsgBox.show(e.title,{confirmName:e.confirm||"确定",cancelName:e.cancel||"取消",callBack:function(){o.$body.removeClass("btnClick-none"),sdk.common.ui.MsgBox.remove(),setTimeout(function(){t&&t()},10)},cancel:function(){o.$body.removeClass("btnClick-none"),sdk.common.ui.MsgBox.remove(),setTimeout(function(){n&&n()},10)}},"confirm",!0)},_isShowMultiAccount:function(){var e=!0,t=S.global.versionCompare(S.global.version,rConfig.VERSIONS.PHONENUMBER_LOGIN_VERSION);return t!==!1&&t>=0&&(e=!1),e&&this.$el.find("#multiAccountManager").removeClass("ms-ni"),e}});S.SSVW.UserLn=Backbone.View.extend({el:"#userContainer",events:{"onclick #autoLoginSwitchLn":"setAutoLoginStatus","onclick #exitBtnLn":"logoutCurrUser","onclick #multiAccountBtnLn":"gotoMultiAccount","onclick .account_del_ln":"showDelAccountHisConfirmBox","onclick .swit_acc_ln":"switAccHandler","onclick #RegBackLn":"goBack"},initialize:function(){_.bindAll(this),this.controller=S.SSCT.GetHandler("Controller","UserLn"),this.ssoController=S.SSCT.GetHandler("Controller","SsoLn"),this.generalController=S.SSCT.GetHandler("Controller","General");var t=S.global.versionCompare(S.global.version,rConfig.VERSIONS.SECURITY_VERSION);t!==!1&&t>=0?$("body").data("ctrl","true"):$("body").data("ctrl","")},userInfo:function(){S.SCEV.Proxy.trigger(S.SCEV.EventType.PRE_ROUTE,{enterPage:sdk.Log.businesses.PAGE_USER,enterBusiness:["management"]}),this.controller.getCurUserInfo();var t=this.controller.getCurUser(),e=this,o=e.ssoController.removeFirmSuffix(t.account);o.length>S.global.channelSetting.accountLen&&(o=o.substr(0,S.global.channelSetting.accountLen-1)+"..."),this.$el.find("#myAccountLn").text(e.ssoController.removeFirmSuffix(o)),this._entranceControl(),this._getHistData(function(){$accountNo=e.$el.find("#accountNoLn"),$accountNo.addClass("pag_blue");var t=e.ssoController.histLength[rConfig.ACCOUNT_TYPE.UC];t>99?$accountNo.text("N"):$accountNo.text(t)},!0),this.$el.find("#sdkVersionLn").html(eConfig.version)},setAutoLoginStatus:function(){function t(){n.addClass("on"),i.$el.find("#autoLoginNotiLn").html("关闭后每次进入游戏时可重新选择账号进行登录。")}function e(){n.removeClass("on"),i.$el.find("#autoLoginNotiLn").html("开启后将自动使用最近登录的账号进入游戏。")}function o(t){t.msg&&i._showErrorMsg(t.msg)}var n=this.$el.find("#autoLoginSwitchLn"),i=this;n.hasClass("on")?(sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_CloseAutoLogin_b","usercenter"]),this.controller.setAutoLoginState({isAutoLogin:!1},{success:e,error:o})):(sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_OpenAutoLogin_b","usercenter"]),this.controller.setAutoLoginState({isAutoLogin:!0},{success:t,error:o}))},logoutCurrUser:function(){var t=this;sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_Account_Logout_b"]),sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_Account_Logout_w"]),this._confirm({title:'<div><center><p class="gr-f16">确定要退出当前账号？</p></center></div>',confirm:"退出账号",cancel:"取消"},function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_Account_LogoutOK_b"]),S.sdkBase.request(S.sdkBase.servType.LOGIN,S.sdkBase.actions.LOGOUT),t.controller.notifyCp({code:1,msg:""},{success:function(){t.controller.sdkExit()},error:function(){t._showErrorMsg("通知游戏失败")}},"logout"),sdk.PageCache.set("clear_history",1)},function(){},"confirm")},gotoMultiAccount:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_account_AccountManage_l"]),sdk.Log.pageEnter(sdk.Log.businesses.PAGE_USER,["multiAccount"]),S.Url.location.route("#!user/multiAccount")},multiAccount:function(){function t(){n.enableGotoStatus=!0;for(var t=document.querySelectorAll(".gotoStatus"),e=0;e<t.length;e++)t[e].style.visibility="visible"}var e="",o=this.controller.getCurUser(),n=this;this.editMode=!1,this._getHistData(function(t){_.each(t,function(t){t.account=n.ssoController.removeFirmSuffix(t.account),itemHtml=template("account_info_item_templ_ln",{gameName:_.isEmpty(t.gameName)?"空":t.gameName,account:t.account,dispAccount:t.account.replace("@",'<span class="at at-s12"></span>'),status:t.account==n.ssoController.removeFirmSuffix(o.account)?"icon_st":""}),e+=itemHtml});var i=$("#accountInfosLn");i.addClass("btnClick-none"),i.html(e),S.SCEV.Proxy.trigger(S.SCEV.EventType.SDK_REMOVE_WIN_EVENT,{eventName:"bridgeTopBtnClicked"}),S.SCEV.Proxy.trigger(S.SCEV.EventType.SDK_WINDOW_EVENT,{eventName:"bridgeTopBtnClicked",handler:function(t){"backToUser"==t.action&&(sdk.common.ui.MsgBox.remove(),S.Url.back()),"onEdit"==t.action&&n.editMode===!0?n._cancelEditMode():"onEdit"==t.action&&n.editMode!==!0&&n._showEditMode()}})},!0);var i=S.global.versionCompare(S.global.version,rConfig.VERSIONS.AUTO_LOGIN_VERSION);i!==!1&&i>=0&&(!_.isUndefined(this.enableUserChange)&&this.enableUserChange?t():this.controller.getFeatureSwitch(this.controller.callBackMix(function(e){n.enableUserChange=e.enableUserChange,e.enableUserChange&&t()})))},showDelAccountHisConfirmBox:function(t){var e=this,o=$(t.target);if(o.hasClass("account_del_ln")){$(t.target).addClass("btnClick-none");var n=t.target.parentNode.parentNode;this._confirm({title:'<div><center><p class="gr-f16">确认在本机删除账号'+$(n).attr("data-account")+"？</p></center></div><div><center><p>被删除账号将不会出现在登录输入框中</p></center></div>",confirm:"确定",cancel:"取消"},function(){e._removeHistory(n)},function(){},"confirm")}},switAccHandler:function(t){if(this.editMode!==!0&&this.enableUserChange&&this.enableGotoStatus){var e=$(t.target);e.addClass("btnClick-none"),$("body").addClass("btnClick-none"),this.$el.addClass("btnClick-none");var o=this,n=this._getAccParent(e),i=e.parent().data("account")||e.parent().parent().data("account")||e.parent().parent().parent().data("account");!i||$(".icon_st",n).length>0||(sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_ChangeAccount_w"]),this._confirm({title:'<div><center><p class="gr-f16">您要切换账号'+i+"登录？</p></center></div>",confirm:"确认",cancel:"取消"},function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_ChangeAccountOK_b"]),i=o.ssoController.addFirmSuffix(i),S.sdkBase.request(S.sdkBase.servType.LOGIN,S.sdkBase.actions.LOGOUT),o.controller.notifyCp({code:1,msg:"",account:i},{success:function(){o.controller.sdkExit()},error:function(){o._showErrorMsg("通知游戏失败")}},"logout")},function(){},"confirm"))}},goBack:function(){history.back()},_getAccParent:function(t){var e=t;return e=e.data("account")?e:e.parent(),e=e.data("account")?e:e.parent(),e=e.data("account")?e:e.parent()},_entranceControl:function(t){var e=this;this.controller.getFeatureSwitch(this.controller.callBackMix(function(o){$autoLoginSwitch=e.$el.find("#autoLoginSwitchLn"),$autoLoginNotice=e.$el.find("#autoLoginNotiLn"),o.isAutoLogin?($autoLoginSwitch.addClass("on"),$autoLoginNotice.html("关闭后每次进入游戏时可重新选择账号进行登录。")):($autoLoginSwitch.removeClass("on"),$autoLoginNotice.html("开启后将自动使用最近登录的账号进入游戏。")),e.enableUserChange=o.enableUserChange,o.enableUserChange&&$("#exitBtnLn").removeClass("ms-ni"),t&&t()},function(){t&&t()}))},_showErrorMsg:function(t){this.generalController.sendClientMsg(t)},_confirm:function(t,e,o,n){$("body").addClass("btnClick-none"),n=_.isEmpty(n)?"confirm":n,sdk.common.ui.MsgBox.show(t.title,{confirmName:t.confirm||"确定",cancelName:t.cancel||"取消",callBack:function(){$("body").removeClass("btnClick-none"),sdk.common.ui.MsgBox.remove(),setTimeout(function(){e&&e()},10)},cancel:function(){$("body").removeClass("btnClick-none"),sdk.common.ui.MsgBox.remove(),setTimeout(function(){o&&o()},10)}},n,!0)},_getHistData:function(t,e){var o=this,n=rConfig.ACCOUNT_TYPE.UC,i=this.ssoController.getHistories(n);!i||e?this.ssoController.getHistory(n,this.controller.callBackMix(function(e){t&&t(e)},function(t){o._showErrorMsg(t)})):t&&t(i)},_showEditMode:function(){this.editMode=!0,this.generalController.setHeaderStyle({topBarBtnBackGame:{text:"完成",visible:!0,visiblePersist:!1,btnShape:"rect"}});for(var t=document.querySelectorAll(".delStatus"),e=0;e<t.length;e++)t[e].style.display="block";if(this.enableGotoStatus===!0)for(var o=document.querySelectorAll(".gotoStatus"),e=0;e<o.length;e++)o[e].style.visibility="hidden"},_cancelEditMode:function(){this.editMode=!1,this.generalController.setHeaderStyle({topBarBtnBackGame:{text:"编辑",visible:!0,visiblePersist:!1,btnShape:"rect"}});for(var t=document.querySelectorAll(".delStatus"),e=0;e<t.length;e++)t[e].style.display="none";if(this.enableGotoStatus===!0)for(var o=document.querySelectorAll(".gotoStatus"),e=0;e<o.length;e++)o[e].style.visibility="visible"},_removeHistory:function(t){var e=t,o=$(e).attr("data-account"),n=rConfig.ACCOUNT_TYPE.UC,i=this;this.controller.removeHistory({accountType:n,account:this.ssoController.addFirmSuffix(o)},this.controller.callBackMix(function(){ucf.Cache.remove("user_info_"+o,!0),$(e).remove()},function(){i._showErrorMsg()}))}});S.SSVW.Vip=Backbone.View.extend({el:"#userContainer",events:{"onclick #cancelLightVipBtn":"cancelLightVip","onclick #keepGotoLightVipBtn":"keepGotoLightVip","onclick #becomeVipBtn":"gotoBecomeVip","onclick #lightVip":"gotoLightVip"},initialize:function(){},gotoBecomeVip:function(){sdk.Log.pageEnter(sdk.Log.businesses.PAGE_USER,["becomeVip"]),sdk.Log.pageClose(sdk.Log.businesses.PAGE_USER,["becomeVip"]),sdk.PageCache.set("sdk_redirect_out",1);var e=eConfig.becomeVip;S.Url.redirect(e)},gotoLightVip:function(){$("body").addClass("btnClick-none");var e=this;S.sdkBase.request(S.sdkBase.servType.APP,S.sdkBase.actions.OVERRIDE_BACK_BTN,{override:!0}),document.addEventListener("backbutton",function(){e.cancelLightVip()});var i=document.body.clientHeight+"px";this.$el.find("#lightVipMask").css("height",i),this.$el.find("#isLightVipBox").css("display","block")},cancelLightVip:function(){S.sdkBase.request(S.sdkBase.servType.APP,S.sdkBase.actions.OVERRIDE_BACK_BTN,{override:!1}),this.$el.find("#isLightVipBox").css("display","none"),$("body").removeClass("btnClick-none")},keepGotoLightVip:function(){S.Url.redirect(eConfig.lightVip),this.cancelLightVip()}});